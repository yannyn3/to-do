<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; connect-src 'self' https://*.openai.com https://*.anthropic.com https://*.claude.ai https://*.aiporters.com https://*.ai21.com https://*.cohere.ai https://*.mistral.ai https://*.replicate.com https://*.stability.ai https://*.huggingface.co https://*.deepinfra.com https://*.aliyuncs.com https://*.baidu.com https://*.xfyun.cn https://*.azure.com https://*.googleapis.com https://*.amazon.com https://*.amazonaws.com https://*.api2d.net https://*.api2gpt.com https://*.one-api.com https://*.poe.com https://*.perplexity.ai https://*.gemini.com https://*.google.com https://*.api.ai https://*.api-inference.huggingface.co; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æå…‰ä»»åŠ¡ | AuroraTasks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        // Tailwind é…ç½®
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        aurora: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6', // ä¸»è‰²è°ƒï¼šç´«ç½—å…°
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        },
                        teal: {
                            50: '#f0fdfa',
                            100: '#ccfbf1',
                            200: '#99f6e4',
                            300: '#5eead4',
                            400: '#2dd4bf',
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e',
                            800: '#115e59',
                            900: '#134e4a',
                        },
                        accent: {
                            light: 'rgba(139, 92, 246, 0.3)',
                            DEFAULT: 'rgba(139, 92, 246, 0.85)',
                            dark: 'rgba(124, 58, 237, 0.9)',
                        }
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Helvetica Neue', 'Microsoft YaHei', 'WenQuanYi Micro Hei', 'Arial', 'sans-serif']
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                }
            }
        }
    </script>
    <style>
        /* ç»ç’ƒç‰¹æ•ˆ */
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }
        
        .dark .glass {
            background: rgba(40, 40, 40, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        /* è‡ªå®šä¹‰å¤é€‰æ¡†æ ·å¼ */
        .checkbox-custom {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid rgba(139, 92, 246, 0.5);
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .checkbox-custom:checked {
            background-color: rgba(139, 92, 246, 0.9);
            border-color: rgba(139, 92, 246, 0.9);
        }
        
        .checkbox-custom:checked::after {
            content: 'âœ“';
            font-size: 14px;
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .dark .checkbox-custom {
            border-color: rgba(139, 92, 246, 0.5);
        }
        
        .dark .checkbox-custom:checked {
            background-color: rgba(139, 92, 246, 0.9);
            border-color: rgba(139, 92, 246, 0.9);
        }
        
        /* ä»»åŠ¡å¡ç‰‡æ‚¬åœæ•ˆæœ */
        .task-card {
            transition: all 0.3s ease;
        }
        
        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.07);
        }
        
        .dark .task-card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        /* ä¸»èƒŒæ™¯æ¸å˜ */
        .main-container {
            background-image: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(245,243,255,0.85));
            min-height: 100vh;
        }
        
        .dark .main-container {
            background-image: linear-gradient(135deg, rgba(15,23,42,0.9), rgba(15,23,42,0.8));
        }
        
        /* ä»»åŠ¡å®ŒæˆåŠ¨ç”»æ•ˆæœ */
        @keyframes taskComplete {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .task-complete-animation {
            animation: taskComplete 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        /* ç¤¼èŠ±ç²’å­åŠ¨ç”» */
        @keyframes confetti-fall {
            0% { transform: translateY(-10px); opacity: 1; }
            100% { transform: translateY(100px); opacity: 0; }
        }
        
        @keyframes confetti-shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(5px); }
            50% { transform: translateX(-5px); }
            75% { transform: translateX(3px); }
            100% { transform: translateX(0); }
        }
        
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            pointer-events: none;
            opacity: 0;
            z-index: 9999;
            animation: confetti-fall 1.5s linear forwards, confetti-shake 1.5s ease-in-out forwards;
        }
        
        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        /* æŒ‰é’®äº¤äº’æ•ˆæœ */
        .btn-effect {
            transition: all 0.2s ease;
        }
        
        .btn-effect:hover {
            transform: translateY(-2px);
        }
        
        .btn-effect:active {
            transform: scale(0.98);
        }
        
        /* é¡µé¢è¿‡æ¸¡åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease forwards;
        }
        
        /* æ¨¡æ€æ¡†è¿‡æ¸¡æ•ˆæœ */
        .modal-transition {
            transition: all 0.3s ease-in-out;
        }
        
        .modal-enter {
            opacity: 0;
            transform: translateY(20px) scale(0.95);
        }
        
        .modal-enter-active {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        /* æ¸¸æˆæ¨¡å¼å¾½ç«  */
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        /* åˆ†éš”çº¿ */
        .divider {
            height: 1px;
            width: 100%;
            margin: 1rem 0;
            background: linear-gradient(90deg, transparent, rgba(156, 163, 175, 0.2), transparent);
        }
        
        .dark .divider {
            background: linear-gradient(90deg, transparent, rgba(156, 163, 175, 0.1), transparent);
        }
        
        /* æ»šåŠ¨æ¡è‡ªå®šä¹‰ */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.5);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.7);
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.3);
        }
        
        .dark ::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.5);
        }
        
        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
        }
        
        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 5px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            pointer-events: none;
            z-index: 50;
        }
        
        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
        }
        
        /* æ—¥å†ç½‘æ ¼æ ·å¼ - å°æ–¹å—ç‰ˆæœ¬ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            position: relative;
            transition: all 0.2s ease;
            font-size: 0.7rem;
            padding: 2px;
        }
        
        .calendar-day:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .day-number {
            font-weight: 500;
            font-size: 0.75rem;
        }
        
        /* æˆå°±å‹‹ç« æ ·å¼ */
        .achievement {
            border-radius: 0.5rem;
            border: 1px solid rgba(139, 92, 246, 0.3);
            transition: all 0.3s ease;
        }
        
        .achievement:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.15);
        }
        
        /* é—ªçƒæ•ˆæœ */
        @keyframes blink {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        .blink {
            animation: blink 2s infinite;
        }
        
        /* åº”ç”¨Logoæ ·å¼ */
        .app-logo {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
            box-shadow: 0 4px 10px rgba(139, 92, 246, 0.3);
            cursor: pointer;
        }
        
        .app-logo::before {
            content: '';
            position: absolute;
            width: 30px;
            height: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
            top: 10px;
            left: 5px;
            opacity: 0.8;
            filter: blur(1px);
        }
        
        .app-logo::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            top: 22px;
            left: 10px;
            opacity: 0.6;
            filter: blur(1px);
        }
        
        .logo-stars {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 2px 1px rgba(255, 255, 255, 0.5);
        }
        
        /* AIå»ºè®®åŠ¨ç”» */
        @keyframes pulse-border {
            0% { border-color: rgba(139, 92, 246, 0.3); }
            50% { border-color: rgba(139, 92, 246, 0.8); }
            100% { border-color: rgba(139, 92, 246, 0.3); }
        }
        
        .ai-suggestion {
            animation: pulse-border 2s infinite;
        }
        
        /* æŒ‘æˆ˜æ ‡å¿— */
        .challenge-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
            color: white;
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(109, 40, 217, 0.2);
        }
        
        /* ç»Ÿè®¡å›¾è¡¨å®¹å™¨ */
        .chart-container {
            width: 100%;
            height: 0;
            padding-bottom: 50%;
            position: relative;
        }
        
        /* åº”ç”¨åå­—æ ·å¼ */
        .app-title {
            cursor: pointer;
        }
    </style>
</head>
<body class="font-sans text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div class="main-container p-4 md:p-6">
        <!-- é¡µé¢é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="glass rounded-2xl p-5 mb-6 flex flex-col md:flex-row items-center justify-between">
            <div class="flex items-center cursor-pointer" id="logo-home-link">
                <div class="app-logo mr-3">
                    <div class="logo-stars" style="top:8px; left:8px;"></div>
                    <div class="logo-stars" style="top:20px; left:18px;"></div>
                    <div class="logo-stars" style="top:15px; left:28px;"></div>
                </div>
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-center md:text-left app-title">
                        <span class="app-name" data-en="AuroraTasks" data-zh="æå…‰ä»»åŠ¡">æå…‰ä»»åŠ¡</span>
                        <span class="text-aurora-500">âœ¨</span>
                    </h1>
                    <p class="text-gray-600 dark:text-gray-300 text-sm md:text-base">
                        <span class="app-desc" data-en="Intelligent task management" data-zh="æ™ºèƒ½ä»»åŠ¡ç®¡ç†">æ™ºèƒ½ä»»åŠ¡ç®¡ç†</span>
                    </p>
                </div>
            </div>
            <div class="flex items-center mt-4 md:mt-0 flex-wrap justify-center">
                <button id="stats-button" class="glass btn-effect px-4 py-2 rounded-xl mr-2 mb-2 md:mb-0 text-sm flex items-center">
                    <i class="fas fa-chart-line mr-2"></i>
                    <span class="stats-text" data-en="Stats" data-zh="ç»Ÿè®¡">ç»Ÿè®¡</span>
                </button>
                <button id="habit-button" class="glass btn-effect px-4 py-2 rounded-xl mr-2 mb-2 md:mb-0 text-sm flex items-center">
                    <i class="fas fa-calendar-check mr-2"></i>
                    <span class="habit-text" data-en="Habits" data-zh="ä¹ æƒ¯">ä¹ æƒ¯</span>
                </button>
                <button id="search-button" class="glass btn-effect px-4 py-2 rounded-xl mr-2 mb-2 md:mb-0 text-sm flex items-center">
                    <i class="fas fa-search mr-2"></i>
                    <span class="search-text" data-en="Search" data-zh="æœç´¢">æœç´¢</span>
                </button>
                <button id="game-mode-toggle" class="glass btn-effect px-4 py-2 rounded-xl mr-2 mb-2 md:mb-0 text-sm flex items-center">
                    <i class="fas fa-gamepad mr-2"></i>
                    <span class="game-mode-text" data-en="Game Mode" data-zh="æ¸¸æˆæ¨¡å¼">æ¸¸æˆæ¨¡å¼</span>
                </button>
                <button id="archive-button" class="glass btn-effect px-4 py-2 rounded-xl mr-2 mb-2 md:mb-0 text-sm flex items-center">
                    <i class="fas fa-archive mr-2"></i>
                    <span class="archive-text" data-en="Archives" data-zh="å½’æ¡£">å½’æ¡£</span>
                </button>
                <button id="settings-button" class="glass btn-effect px-4 py-2 rounded-xl mr-2 mb-2 md:mb-0 text-sm flex items-center">
                    <i class="fas fa-cog mr-2"></i>
                    <span class="settings-text" data-en="Settings" data-zh="è®¾ç½®">è®¾ç½®</span>
                </button>
                <button id="theme-toggle" class="glass btn-effect p-2 rounded-xl">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:block"></i>
                </button>
            </div>
        </header>
        
        <!-- æ¸¸æˆæ¨¡å¼çŠ¶æ€æ  (é»˜è®¤éšè—) -->
        <section id="game-stats" class="glass rounded-2xl p-4 mb-6 hidden">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex items-center mb-3 md:mb-0">
                    <div class="text-2xl mr-2">ğŸ†</div>
                    <div>
                        <span class="level-text" data-en="Level" data-zh="ç­‰çº§">ç­‰çº§</span>
                        <span id="player-level" class="text-xl font-bold ml-1">1</span>
                    </div>
                    <div class="mx-4 hidden md:block text-gray-300">|</div>
                    <div class="flex items-center mt-2 md:mt-0">
                        <div class="text-lg mr-2">â­</div>
                        <div>
                            <span class="points-text" data-en="Points" data-zh="ç§¯åˆ†">ç§¯åˆ†</span>
                            <span id="player-points" class="font-semibold ml-1">0</span>
                        </div>
                    </div>
                    <div class="mx-4 hidden md:block text-gray-300">|</div>
                    <div class="flex items-center mt-2 md:mt-0">
                        <div class="text-lg mr-2">ğŸ”¥</div>
                        <div>
                            <span class="streak-text" data-en="Streak" data-zh="è¿ç»­">è¿ç»­</span>
                            <span id="player-streak" class="font-semibold ml-1">0</span>
                            <span class="days-text" data-en="days" data-zh="å¤©">å¤©</span>
                        </div>
                    </div>
                </div>
                <div class="w-full md:w-1/2">
                    <div class="flex justify-between text-xs mb-1">
                        <span id="level-progress-text">0/100</span>
                        <span class="next-level-text" data-en="Next level" data-zh="ä¸‹ä¸€çº§">ä¸‹ä¸€çº§</span>
                    </div>
                    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div id="level-progress-bar" class="h-full bg-aurora-500 rounded-full progress-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <!-- ä»Šæ—¥æŒ‘æˆ˜ -->
            <div class="mt-4 pt-3 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center mb-2">
                    <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                    <h3 class="text-sm font-semibold daily-challenge-text" data-en="Daily Challenge" data-zh="ä»Šæ—¥æŒ‘æˆ˜">ä»Šæ—¥æŒ‘æˆ˜</h3>
                </div>
                <div id="daily-challenge" class="text-sm bg-aurora-50 dark:bg-gray-800 p-3 rounded-lg">
                    <div class="flex items-center">
                        <span id="challenge-icon" class="text-xl mr-2">ğŸš€</span>
                        <span id="challenge-text">å®Œæˆ3ä¸ªä»»åŠ¡ï¼Œè·å¾—é¢å¤–20ç§¯åˆ†</span>
                    </div>
                    <div class="mt-2 flex items-center">
                        <div class="flex-1 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div id="challenge-progress" class="h-full bg-yellow-500 rounded-full" style="width: 0%"></div>
                        </div>
                        <span id="challenge-progress-text" class="ml-2 text-xs">0/3</span>
                    </div>
                </div>
            </div>
        </section>
        
        <main>
            <!-- ä»Šæ—¥ä»»åŠ¡å®¹å™¨ -->
            <section id="today-container" class="mb-8">
                <div class="flex justify-between items-center mb-5">
                    <div>
                        <h2 id="today-date" class="text-xl md:text-2xl font-bold"></h2>
                        <p id="tasks-count" class="text-gray-600 dark:text-gray-300 text-sm tasks-loading" data-en="Loading tasks..." data-zh="æ­£åœ¨åŠ è½½ä»»åŠ¡...">æ­£åœ¨åŠ è½½ä»»åŠ¡...</p>
                    </div>
                    <button id="add-task-button" class="glass btn-effect text-aurora-500 dark:text-aurora-300 px-4 py-2 md:px-5 md:py-3 rounded-xl flex items-center">
                        <i class="fas fa-plus mr-2"></i>
                        <span class="add-task-text" data-en="Add Task" data-zh="æ·»åŠ ä»»åŠ¡">æ·»åŠ ä»»åŠ¡</span>
                    </button>
                </div>
                
                <div id="tasks-container" class="grid grid-cols-1 gap-4"></div>
            </section>
            
            <!-- ä¹ æƒ¯è¿½è¸ªå®¹å™¨ (é»˜è®¤éšè—) -->
            <section id="habit-container" class="hidden fade-in">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl md:text-2xl font-bold habit-tracking-title" data-en="Habit Tracking" data-zh="ä¹ æƒ¯è¿½è¸ª">ä¹ æƒ¯è¿½è¸ª</h2>
                    <button id="back-from-habit" class="glass btn-effect px-4 py-2 rounded-xl text-aurora-500 dark:text-aurora-300">
                        <i class="fas fa-arrow-left mr-2"></i>
                        <span class="back-text" data-en="Back" data-zh="è¿”å›">è¿”å›</span>
                    </button>
                </div>
                
                <div class="flex flex-col md:flex-row gap-6">
                    <!-- æœˆå†è§†å›¾ -->
                    <div class="glass rounded-2xl p-5 w-full md:w-2/3">
                        <div class="flex items-center justify-between mb-4">
                            <button id="prev-month" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h3 id="calendar-month-title" class="text-lg font-semibold">2023å¹´10æœˆ</h3>
                            <button id="next-month" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        
                        <!-- æ˜ŸæœŸæ ‡é¢˜ -->
                        <div class="calendar-grid mb-2">
                            <div class="text-center text-xs text-gray-500 font-medium">æ—¥</div>
                            <div class="text-center text-xs text-gray-500 font-medium">ä¸€</div>
                            <div class="text-center text-xs text-gray-500 font-medium">äºŒ</div>
                            <div class="text-center text-xs text-gray-500 font-medium">ä¸‰</div>
                            <div class="text-center text-xs text-gray-500 font-medium">å››</div>
                            <div class="text-center text-xs text-gray-500 font-medium">äº”</div>
                            <div class="text-center text-xs text-gray-500 font-medium">å…­</div>
                        </div>
                        
                        <!-- æ—¥å†ç½‘æ ¼ï¼Œå°†ç”±JSå¡«å…… -->
                        <div id="calendar-grid" class="calendar-grid"></div>
                        
                        <!-- é¢œè‰²å›¾ä¾‹ -->
                        <div class="flex items-center justify-center mt-4 text-xs text-gray-600 dark:text-gray-300 space-x-4">
                            <div class="flex items-center">
                                <div class="w-3 h-3 rounded-sm bg-green-500 mr-1"></div>
                                <span class="completed-tasks-text" data-en="All completed" data-zh="å…¨éƒ¨å®Œæˆ">å…¨éƒ¨å®Œæˆ</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 rounded-sm bg-yellow-500 mr-1"></div>
                                <span class="partial-tasks-text" data-en="Partial" data-zh="éƒ¨åˆ†å®Œæˆ">éƒ¨åˆ†å®Œæˆ</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 rounded-sm bg-red-500 mr-1"></div>
                                <span class="no-completion-text" data-en="None" data-zh="æœªå®Œæˆ">æœªå®Œæˆ</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 rounded-sm bg-gray-300 dark:bg-gray-600 mr-1"></div>
                                <span class="no-tasks-text" data-en="No tasks" data-zh="æ— ä»»åŠ¡">æ— ä»»åŠ¡</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ä¹ æƒ¯ç»Ÿè®¡ -->
                    <div class="glass rounded-2xl p-5 w-full md:w-1/3">
                        <h3 class="text-lg font-semibold mb-4 stats-summary-title" data-en="Summary" data-zh="ç»Ÿè®¡æ‘˜è¦">ç»Ÿè®¡æ‘˜è¦</h3>
                        
                        <div class="space-y-4">
                            <!-- å½“æœˆå®Œæˆç‡ -->
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm text-gray-600 dark:text-gray-300 monthly-completion-text" data-en="Monthly Completion" data-zh="å½“æœˆå®Œæˆç‡">å½“æœˆå®Œæˆç‡</span>
                                    <span id="monthly-completion-rate" class="text-sm font-medium">0%</span>
                                </div>
                                <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                    <div id="monthly-completion-bar" class="h-full bg-aurora-500 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <!-- æœ€é•¿è¿ç»­è®°å½• -->
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm text-gray-600 dark:text-gray-300 longest-streak-text" data-en="Longest Streak" data-zh="æœ€é•¿è¿ç»­è®°å½•">æœ€é•¿è¿ç»­è®°å½•</span>
                                    <span id="longest-streak" class="text-sm font-medium">0å¤©</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="text-aurora-500 mr-2">ğŸ”¥</div>
                                    <div class="text-sm" id="streak-dates">æ— è®°å½•</div>
                                </div>
                            </div>
                            
                            <!-- ä»»åŠ¡ç±»å‹åˆ†å¸ƒ -->
                            <div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-2 task-distribution-text" data-en="Task Distribution" data-zh="ä»»åŠ¡ç±»å‹åˆ†å¸ƒ">ä»»åŠ¡ç±»å‹åˆ†å¸ƒ</div>
                                <div class="flex space-x-1">
                                    <div class="flex-1 h-4 bg-green-500 rounded-l-lg" style="width: 60%"></div>
                                    <div class="flex-1 h-4 bg-yellow-500" style="width: 25%"></div>
                                    <div class="flex-1 h-4 bg-red-500 rounded-r-lg" style="width: 15%"></div>
                                </div>
                                <div class="flex justify-between mt-1 text-xs">
                                    <span id="completed-count">0 å·²å®Œæˆ</span>
                                    <span id="active-count">0 è¿›è¡Œä¸­</span>
                                </div>
                            </div>
                            
                            <!-- æœ¬å‘¨è¿›åº¦ -->
                            <div>
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-2 weekly-progress-text" data-en="Weekly Progress" data-zh="æœ¬å‘¨è¿›åº¦">æœ¬å‘¨è¿›åº¦</div>
                                <div class="grid grid-cols-7 gap-1">
                                    <div class="weekly-day h-8 rounded bg-gray-200 dark:bg-gray-700" data-day="0"></div>
                                    <div class="weekly-day h-8 rounded bg-gray-200 dark:bg-gray-700" data-day="1"></div>
                                    <div class="weekly-day h-8 rounded bg-gray-200 dark:bg-gray-700" data-day="2"></div>
                                    <div class="weekly-day h-8 rounded bg-gray-200 dark:bg-gray-700" data-day="3"></div>
                                    <div class="weekly-day h-8 rounded bg-gray-200 dark:bg-gray-700" data-day="4"></div>
                                    <div class="weekly-day h-8 rounded bg-gray-200 dark:bg-gray-700" data-day="5"></div>
                                    <div class="weekly-day h-8 rounded bg-gray-200 dark:bg-gray-700" data-day="6"></div>
                                </div>
                                <div class="flex justify-between mt-1 text-xs">
                                    <span class="monday-text" data-en="Mon" data-zh="å‘¨ä¸€">å‘¨ä¸€</span>
                                    <span class="sunday-text" data-en="Sun" data-zh="å‘¨æ—¥">å‘¨æ—¥</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- ç»Ÿè®¡åˆ†æå®¹å™¨ (é»˜è®¤éšè—) -->
            <section id="stats-container" class="hidden fade-in">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl md:text-2xl font-bold statistics-title" data-en="Statistics" data-zh="æ•°æ®ç»Ÿè®¡">æ•°æ®ç»Ÿè®¡</h2>
                    <button id="back-from-stats" class="glass btn-effect px-4 py-2 rounded-xl text-aurora-500 dark:text-aurora-300">
                        <i class="fas fa-arrow-left mr-2"></i>
                        <span class="back-text" data-en="Back" data-zh="è¿”å›">è¿”å›</span>
                    </button>
                </div>
                
                <!-- ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <!-- æ€»ä»»åŠ¡æ•° -->
                    <div class="glass rounded-2xl p-4">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm text-gray-500 total-tasks-text" data-en="Total Tasks" data-zh="æ€»ä»»åŠ¡æ•°">æ€»ä»»åŠ¡æ•°</p>
                                <h3 id="total-tasks-count" class="text-2xl font-bold mt-1">0</h3>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900 flex items-center justify-center">
                                <i class="fas fa-tasks text-aurora-500"></i>
                            </div>
                        </div>
                        <p id="tasks-trend" class="text-xs text-green-500 mt-2">
                            <i class="fas fa-arrow-up mr-1"></i> <span>0% è¾ƒä¸Šæœˆ</span>
                        </p>
                    </div>
                    
                    <!-- å®Œæˆç‡ -->
                    <div class="glass rounded-2xl p-4">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm text-gray-500 completion-rate-text" data-en="Completion Rate" data-zh="å®Œæˆç‡">å®Œæˆç‡</p>
                                <h3 id="completion-rate" class="text-2xl font-bold mt-1">0%</h3>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-500"></i>
                            </div>
                        </div>
                        <p id="completion-trend" class="text-xs text-green-500 mt-2">
                            <i class="fas fa-arrow-up mr-1"></i> <span>0% è¾ƒä¸Šæœˆ</span>
                        </p>
                    </div>
                    
                    <!-- å¹³å‡æ¯æ—¥ä»»åŠ¡ -->
                    <div class="glass rounded-2xl p-4">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm text-gray-500 daily-average-text" data-en="Daily Average" data-zh="å¹³å‡æ¯æ—¥ä»»åŠ¡">å¹³å‡æ¯æ—¥ä»»åŠ¡</p>
                                <h3 id="daily-average" class="text-2xl font-bold mt-1">0</h3>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                                <i class="fas fa-calendar-day text-blue-500"></i>
                            </div>
                        </div>
                        <p id="average-trend" class="text-xs text-green-500 mt-2">
                            <i class="fas fa-arrow-up mr-1"></i> <span>0% è¾ƒä¸Šæœˆ</span>
                        </p>
                    </div>
                    
                    <!-- è¿ç»­å®Œæˆ -->
                    <div class="glass rounded-2xl p-4">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm text-gray-500 current-streak-text" data-en="Current Streak" data-zh="å½“å‰è¿ç»­è®°å½•">å½“å‰è¿ç»­è®°å½•</p>
                                <h3 id="current-streak" class="text-2xl font-bold mt-1">0 <span class="text-base font-normal days-text" data-en="days" data-zh="å¤©">å¤©</span></h3>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900 flex items-center justify-center">
                                <i class="fas fa-fire text-orange-500"></i>
                            </div>
                        </div>
                        <p id="best-streak" class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-trophy mr-1"></i> <span class="best-record-text" data-en="Best: " data-zh="æœ€å¥½è®°å½•: ">æœ€å¥½è®°å½•: </span><span>0</span> <span class="days-text" data-en="days" data-zh="å¤©">å¤©</span>
                        </p>
                    </div>
                </div>
                
                <!-- ä»»åŠ¡è¶‹åŠ¿å›¾ -->
                <div class="glass rounded-2xl p-5 mb-6">
                    <h3 class="text-lg font-semibold mb-4 task-trend-text" data-en="Task Completion Trend" data-zh="ä»»åŠ¡å®Œæˆè¶‹åŠ¿">ä»»åŠ¡å®Œæˆè¶‹åŠ¿</h3>
                    <div class="chart-container">
                        <canvas id="trend-chart" class="w-full"></canvas>
                    </div>
                </div>
                
                <!-- ä»»åŠ¡è¯¦æƒ…ç»Ÿè®¡ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- æœ€é«˜æ•ˆæ—¥ -->
                    <div class="glass rounded-2xl p-5">
                        <h3 class="text-lg font-semibold mb-4 productive-days-text" data-en="Most Productive Days" data-zh="æœ€é«˜æ•ˆçš„æ—¥å­">æœ€é«˜æ•ˆçš„æ—¥å­</h3>
                        <div id="productive-days-list" class="space-y-3">
                            <!-- ç”±JSå¡«å…… -->
                        </div>
                    </div>
                    
                    <!-- æˆå°±ä¸é‡Œç¨‹ç¢‘ -->
                    <div class="glass rounded-2xl p-5">
                        <h3 class="text-lg font-semibold mb-4 achievements-text" data-en="Achievements" data-zh="æˆå°±ä¸é‡Œç¨‹ç¢‘">æˆå°±ä¸é‡Œç¨‹ç¢‘</h3>
                        <div class="grid grid-cols-2 gap-3" id="achievements-container">
                            <!-- ç”±JSå¡«å…… -->
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- å½’æ¡£å®¹å™¨ (é»˜è®¤éšè—) -->
            <section id="archive-container" class="hidden">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl md:text-2xl font-bold archive-title" data-en="Archives" data-zh="å½’æ¡£">å½’æ¡£</h2>
                    <button id="back-to-today" class="glass btn-effect px-4 py-2 rounded-xl text-aurora-500 dark:text-aurora-300">
                        <i class="fas fa-arrow-left mr-2"></i>
                        <span class="back-text" data-en="Back to Today" data-zh="è¿”å›ä»Šæ—¥">è¿”å›ä»Šæ—¥</span>
                    </button>
                </div>
                
                <div class="glass rounded-2xl p-4 mb-5">
                    <div class="flex flex-wrap" id="years-tabs"></div>
                </div>
                
                <div class="glass rounded-2xl p-4 mb-5">
                    <div class="flex flex-wrap" id="months-tabs"></div>
                </div>
                
                <div id="archived-tasks-container" class="grid grid-cols-1 gap-4"></div>
            </section>
            
            <!-- æœç´¢å®¹å™¨ (é»˜è®¤éšè—) -->
            <section id="search-container" class="hidden">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl md:text-2xl font-bold search-title" data-en="Search Tasks" data-zh="æœç´¢ä»»åŠ¡">æœç´¢ä»»åŠ¡</h2>
                    <button id="back-from-search" class="glass btn-effect px-4 py-2 rounded-xl text-aurora-500 dark:text-aurora-300">
                        <i class="fas fa-arrow-left mr-2"></i>
                        <span class="back-text" data-en="Back to Today" data-zh="è¿”å›ä»Šæ—¥">è¿”å›ä»Šæ—¥</span>
                    </button>
                </div>
                
                <div class="glass rounded-2xl p-5 mb-5">
                    <div class="flex flex-col md:flex-row items-center space-y-3 md:space-y-0 md:space-x-3">
                        <div class="w-full md:w-1/2">
                            <input type="text" id="search-input" class="w-full glass rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500" placeholder="è¾“å…¥å…³é”®è¯æœç´¢">
                        </div>
                        <div class="w-full md:w-1/4">
                            <select id="search-filter" class="w-full glass rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500">
                                <option value="all" class="search-all" data-en="All Tasks" data-zh="æ‰€æœ‰ä»»åŠ¡">æ‰€æœ‰ä»»åŠ¡</option>
                                <option value="completed" class="search-completed" data-en="Completed" data-zh="å·²å®Œæˆ">å·²å®Œæˆ</option>
                                <option value="active" class="search-active" data-en="Active" data-zh="æœªå®Œæˆ">æœªå®Œæˆ</option>
                            </select>
                        </div>
                        <button id="search-execute" class="w-full md:w-auto glass btn-effect px-6 py-3 rounded-xl text-aurora-500 dark:text-aurora-300">
                            <i class="fas fa-search mr-2"></i>
                            <span class="search-button-text" data-en="Search" data-zh="æœç´¢">æœç´¢</span>
                        </button>
                    </div>
                </div>
                
                <div id="search-results-container" class="grid grid-cols-1 gap-4"></div>
            </section>
            
            <!-- è®¾ç½®é¢æ¿ (é»˜è®¤éšè—) -->
            <section id="settings-container" class="hidden">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl md:text-2xl font-bold settings-title" data-en="Settings" data-zh="è®¾ç½®">è®¾ç½®</h2>
                    <button id="back-from-settings" class="glass btn-effect px-4 py-2 rounded-xl text-aurora-500 dark:text-aurora-300">
                        <i class="fas fa-arrow-left mr-2"></i>
                        <span class="back-text" data-en="Back" data-zh="è¿”å›">è¿”å›</span>
                    </button>
                </div>
                
                <div class="glass rounded-2xl p-5 divide-y divide-gray-200 dark:divide-gray-700">
                    <!-- è¯­è¨€è®¾ç½® -->
                    <div class="py-4">
                        <h3 class="text-lg font-medium mb-3 language-title" data-en="Language" data-zh="è¯­è¨€">è¯­è¨€</h3>
                        <div class="flex">
                            <button id="lang-zh" class="glass btn-effect px-4 py-2 rounded-xl mr-3 text-aurora-500 dark:text-aurora-300">
                                ğŸ‡¨ğŸ‡³ ä¸­æ–‡
                            </button>
                            <button id="lang-en" class="glass btn-effect px-4 py-2 rounded-xl text-aurora-500 dark:text-aurora-300">
                                ğŸ‡ºğŸ‡¸ English
                            </button>
                        </div>
                    </div>
                    
                    <!-- AIåŠ©æ‰‹è®¾ç½® -->
                    <div class="py-4">
                        <h3 class="text-lg font-medium mb-3 ai-assistant-title" data-en="AI Assistant" data-zh="AIåŠ©æ‰‹">AIåŠ©æ‰‹</h3>
                        <div class="mb-3">
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="ai-enabled" class="h-5 w-5 rounded text-aurora-500 focus:ring-aurora-500">
                                <span class="ml-2 ai-enabled-text" data-en="Enable AI Assistant" data-zh="å¯ç”¨AIåŠ©æ‰‹">å¯ç”¨AIåŠ©æ‰‹</span>
                            </label>
                        </div>
                        <div id="ai-settings" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1 api-provider-label" for="api-provider" data-en="API Provider" data-zh="APIæä¾›å•†">APIæä¾›å•†</label>
                                <select id="api-provider" class="w-full glass rounded-xl px-4 py-2 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500">
                                    <option value="openai">OpenAI</option>
                                    <option value="anthropic">Anthropic</option>
                                    <option value="gemini">Google Gemini</option>
                                    <option value="custom">è‡ªå®šä¹‰</option>
                                    <option value="poe">Poe</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-1 api-key-label" for="api-key" data-en="API Key" data-zh="APIå¯†é’¥">APIå¯†é’¥</label>
                                <input type="password" id="api-key" class="w-full glass rounded-xl px-4 py-2 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500" placeholder="sk-...">
                            </div>
                            
                            <div id="custom-endpoint-container" class="hidden">
                                <label class="block text-sm font-medium mb-1 endpoint-url-label" for="endpoint-url" data-en="Endpoint URL" data-zh="ç«¯ç‚¹URL">ç«¯ç‚¹URL</label>
                                <input type="text" id="endpoint-url" class="w-full glass rounded-xl px-4 py-2 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500" placeholder="https://api.example.com/v1/chat/completions">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-1 model-label" for="ai-model" data-en="Model" data-zh="æ¨¡å‹">æ¨¡å‹</label>
                                <select id="ai-model" class="w-full glass rounded-xl px-4 py-2 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500">
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                    <option value="gpt-4">GPT-4</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                    <option value="claude-3-opus">Claude 3 Opus</option>
                                    <option value="claude-3-sonnet">Claude 3 Sonnet</option>
                                    <option value="gemini-pro">Gemini Pro</option>
                                    <option value="custom">è‡ªå®šä¹‰</option>
                                </select>
                            </div>
                            
                            <div id="custom-model-container" class="hidden">
                                <label class="block text-sm font-medium mb-1 custom-model-label" for="custom-model" data-en="Custom Model Name" data-zh="è‡ªå®šä¹‰æ¨¡å‹åç§°">è‡ªå®šä¹‰æ¨¡å‹åç§°</label>
                                <input type="text" id="custom-model" class="w-full glass rounded-xl px-4 py-2 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500" placeholder="model-name">
                            </div>
                            
                            <button id="test-ai-connection" class="glass btn-effect px-4 py-2 rounded-xl text-aurora-500 dark:text-aurora-300 mt-2">
                                <i class="fas fa-plug mr-2"></i>
                                <span class="test-connection-text" data-en="Test Connection" data-zh="æµ‹è¯•è¿æ¥">æµ‹è¯•è¿æ¥</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- æ•°æ®ç®¡ç† -->
                    <div class="py-4">
                        <h3 class="text-lg font-medium mb-3 data-management-title" data-en="Data Management" data-zh="æ•°æ®ç®¡ç†">æ•°æ®ç®¡ç†</h3>
                        <div class="flex flex-wrap">
                            <button id="export-json" class="glass btn-effect px-4 py-2 rounded-xl mr-3 mb-3 text-aurora-500 dark:text-aurora-300">
                                <i class="fas fa-file-export mr-2"></i>
                                <span class="export-json-text" data-en="Export (JSON)" data-zh="å¯¼å‡º (JSON)">å¯¼å‡º (JSON)</span>
                            </button>
                            <button id="export-markdown" class="glass btn-effect px-4 py-2 rounded-xl mr-3 mb-3 text-aurora-500 dark:text-aurora-300">
                                <i class="fas fa-file-alt mr-2"></i>
                                <span class="export-markdown-text" data-en="Export (Markdown)" data-zh="å¯¼å‡º (Markdown)">å¯¼å‡º (Markdown)</span>
                            </button>
                            <button id="import-data" class="glass btn-effect px-4 py-2 rounded-xl mr-3 mb-3 text-aurora-500 dark:text-aurora-300">
                                <i class="fas fa-file-import mr-2"></i>
                                <span class="import-text" data-en="Import" data-zh="å¯¼å…¥">å¯¼å…¥</span>
                            </button>
                            <input type="file" id="import-file" accept=".json" class="hidden">
                        </div>
                        <div class="mt-2 text-sm text-gray-600 dark:text-gray-400 data-warning" data-en="Warning: Importing data will replace your current tasks." data-zh="è­¦å‘Šï¼šå¯¼å…¥æ•°æ®å°†æ›¿æ¢æ‚¨å½“å‰çš„æ‰€æœ‰ä»»åŠ¡ã€‚">è­¦å‘Šï¼šå¯¼å…¥æ•°æ®å°†æ›¿æ¢æ‚¨å½“å‰çš„æ‰€æœ‰ä»»åŠ¡ã€‚</div>
                    </div>
                    
                    <!-- æ¸¸æˆæ¨¡å¼è®¾ç½® -->
                    <div class="py-4">
                        <h3 class="text-lg font-medium mb-3 game-settings-title" data-en="Game Mode Settings" data-zh="æ¸¸æˆæ¨¡å¼è®¾ç½®">æ¸¸æˆæ¨¡å¼è®¾ç½®</h3>
                        <div class="space-y-3">
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="challenge-enabled" class="h-5 w-5 rounded text-aurora-500 focus:ring-aurora-500" checked="">
                                <span class="ml-2 daily-challenges-text" data-en="Daily challenges" data-zh="æ¯æ—¥æŒ‘æˆ˜">æ¯æ—¥æŒ‘æˆ˜</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="achievements-enabled" class="h-5 w-5 rounded text-aurora-500 focus:ring-aurora-500" checked="">
                                <span class="ml-2 achievement-system-text" data-en="Achievement system" data-zh="æˆå°±ç³»ç»Ÿ">æˆå°±ç³»ç»Ÿ</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="confetti-enabled" class="h-5 w-5 rounded text-aurora-500 focus:ring-aurora-500" checked="">
                                <span class="ml-2 confetti-text" data-en="Show completion effects" data-zh="æ˜¾ç¤ºå®Œæˆæ•ˆæœ">æ˜¾ç¤ºå®Œæˆæ•ˆæœ</span>
                            </label>
                            <button id="reset-game-progress" class="glass btn-effect px-4 py-2 rounded-xl text-red-500">
                                <i class="fas fa-redo-alt mr-2"></i>
                                <span class="reset-progress-text" data-en="Reset Progress" data-zh="é‡ç½®è¿›åº¦">é‡ç½®è¿›åº¦</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- å…¶ä»–è®¾ç½® -->
                    <div class="py-4">
                        <h3 class="text-lg font-medium mb-3 other-settings-title" data-en="Other Settings" data-zh="å…¶ä»–è®¾ç½®">å…¶ä»–è®¾ç½®</h3>
                        <div class="space-y-3">
                            <button id="clear-all-data" class="glass btn-effect px-4 py-2 rounded-xl text-red-500">
                                <i class="fas fa-trash-alt mr-2"></i>
                                <span class="clear-all-data-text" data-en="Clear All Data" data-zh="æ¸…é™¤æ‰€æœ‰æ•°æ®">æ¸…é™¤æ‰€æœ‰æ•°æ®</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- ä»»åŠ¡è¡¨å•æ¨¡æ€æ¡† (é»˜è®¤éšè—) -->
        <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="glass rounded-2xl p-6 max-w-lg w-full mx-4 modal-transition modal-enter">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modal-title" class="text-xl font-bold modal-title" data-en="Add New Task" data-zh="æ·»åŠ æ–°ä»»åŠ¡">æ·»åŠ æ–°ä»»åŠ¡</h3>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="task-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1 task-title-label" for="task-title" data-en="Task Title" data-zh="ä»»åŠ¡æ ‡é¢˜">ä»»åŠ¡æ ‡é¢˜</label>
                        <input type="text" id="task-title" class="w-full glass rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500" required="">
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between">
                            <label class="block text-sm font-medium mb-1 task-problem-label" for="task-problem" data-en="Problem/Challenge (Optional)" data-zh="é—®é¢˜/éš¾ç‚¹ (å¯é€‰)">é—®é¢˜/éš¾ç‚¹ (å¯é€‰)</label>
                        </div>
                        <textarea id="task-problem" class="w-full glass rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500 min-h-[80px]"></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <div class="flex justify-between">
                            <label class="block text-sm font-medium mb-1 task-solution-label" for="task-solution" data-en="Solution (Optional)" data-zh="è§£å†³æ–¹æ¡ˆ (å¯é€‰)">è§£å†³æ–¹æ¡ˆ (å¯é€‰)</label>
                        </div>
                        <textarea id="task-solution" class="w-full glass rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-aurora-500 min-h-[80px]"></textarea>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="button" id="cancel-task" class="glass btn-effect px-5 py-2 rounded-xl mr-3 cancel-button" data-en="Cancel" data-zh="å–æ¶ˆ">å–æ¶ˆ</button>
                        <button type="submit" class="bg-aurora-500 hover:bg-aurora-600 text-white px-5 py-2 rounded-xl btn-effect save-button" data-en="Save Task" data-zh="ä¿å­˜ä»»åŠ¡">ä¿å­˜ä»»åŠ¡</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- AIå»ºè®®æ¨¡æ€æ¡† (é»˜è®¤éšè—) -->
        <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="glass rounded-2xl p-6 max-w-lg w-full mx-4 modal-transition modal-enter">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold ai-suggestion-title" data-en="AI Suggestions" data-zh="AIå»ºè®®">AIå»ºè®®</h3>
                    <button id="close-ai-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="ai-loading" class="py-8 flex flex-col items-center justify-center">
                    <div class="w-12 h-12 border-4 border-aurora-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p class="text-gray-600 dark:text-gray-300 generating-suggestions-text" data-en="Generating suggestions..." data-zh="æ­£åœ¨ç”Ÿæˆå»ºè®®...">æ­£åœ¨ç”Ÿæˆå»ºè®®...</p>
                </div>
                
                <div id="ai-content" class="hidden">
                    <div class="mb-4">
                        <h4 class="text-lg font-medium mb-2 problem-analysis-title" data-en="Problem Analysis" data-zh="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ</h4>
                        <div id="ai-problem-analysis" class="glass rounded-xl p-4 text-gray-700 dark:text-gray-300"></div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="text-lg font-medium mb-2 suggested-solutions-title" data-en="Suggested Solutions" data-zh="æ¨èè§£å†³æ–¹æ¡ˆ">æ¨èè§£å†³æ–¹æ¡ˆ</h4>
                        <div id="ai-solutions" class="glass rounded-xl p-4 text-gray-700 dark:text-gray-300"></div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-medium mb-2 recommended-methods-title" data-en="Recommended AI Keywords" data-zh="æ¨èAIå…³é”®è¯">æ¨èAIå…³é”®è¯</h4>
                        <div id="ai-methods" class="glass rounded-xl p-4 text-gray-700 dark:text-gray-300"></div>
                    </div>
                    
                    <div class="flex justify-end mt-6">
                        <button id="apply-ai-suggestions" class="bg-aurora-500 hover:bg-aurora-600 text-white px-5 py-2 rounded-xl btn-effect">
                            <i class="fas fa-magic mr-2"></i>
                            <span class="apply-suggestions-text" data-en="Apply Suggestions" data-zh="åº”ç”¨å»ºè®®">åº”ç”¨å»ºè®®</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æˆå°±è§£é”é€šçŸ¥ (é»˜è®¤éšè—) -->
        <div id="achievement-notification" class="fixed bottom-5 right-5 glass rounded-xl p-4 max-w-xs hidden transform transition-all duration-500 translate-y-20 opacity-0 z-50">
            <div class="flex items-center">
                <div class="text-2xl mr-3">ğŸ†</div>
                <div>
                    <div class="font-semibold achievement-unlocked-text" data-en="Achievement Unlocked!" data-zh="è§£é”æˆå°±ï¼">è§£é”æˆå°±ï¼</div>
                    <div id="achievement-name" class="text-sm"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ==================== åŸºç¡€å˜é‡ä¸å¸¸é‡ ====================
        // DOM å…ƒç´ 
        const todayContainer = document.getElementById('today-container');
        const habitContainer = document.getElementById('habit-container');
        const statsContainer = document.getElementById('stats-container');
        const archiveContainer = document.getElementById('archive-container');
        const searchContainer = document.getElementById('search-container');
        const settingsContainer = document.getElementById('settings-container');
        const gameStatsSection = document.getElementById('game-stats');
        const tasksContainer = document.getElementById('tasks-container');
        const archivedTasksContainer = document.getElementById('archived-tasks-container');
        const searchResultsContainer = document.getElementById('search-results-container');
        const taskModal = document.getElementById('task-modal');
        const aiModal = document.getElementById('ai-modal');
        const taskForm = document.getElementById('task-form');
        const taskTitleInput = document.getElementById('task-title');
        const taskProblemInput = document.getElementById('task-problem');
        const taskSolutionInput = document.getElementById('task-solution');
        const modalTitle = document.getElementById('modal-title');
        const todayDateEl = document.getElementById('today-date');
        const tasksCountEl = document.getElementById('tasks-count');
        const yearsTabsEl = document.getElementById('years-tabs');
        const monthsTabsEl = document.getElementById('months-tabs');
        const modalDialog = taskModal.querySelector('.modal-transition');
        const aiModalDialog = aiModal.querySelector('.modal-transition');
        const achievementNotification = document.getElementById('achievement-notification');
        
        // æ¸¸æˆæ¨¡å¼å…ƒç´ 
        const playerLevelEl = document.getElementById('player-level');
        const playerPointsEl = document.getElementById('player-points');
        const playerStreakEl = document.getElementById('player-streak');
        const levelProgressBar = document.getElementById('level-progress-bar');
        const levelProgressText = document.getElementById('level-progress-text');
        const challengeProgress = document.getElementById('challenge-progress');
        const challengeProgressText = document.getElementById('challenge-progress-text');
        
        // åº”ç”¨å˜é‡
        let tasks = []; // ä»»åŠ¡æ•°ç»„
        let currentTaskId = null; // å½“å‰ç¼–è¾‘çš„ä»»åŠ¡ID
        let currentYear = null; // å½“å‰æŸ¥çœ‹çš„å½’æ¡£å¹´ä»½
        let currentMonth = null; // å½“å‰æŸ¥çœ‹çš„å½’æ¡£æœˆä»½
        let gameMode = false; // æ¸¸æˆæ¨¡å¼çŠ¶æ€
        let aiEnabled = false; // AIåŠ©æ‰‹çŠ¶æ€
        let appLang = 'zh'; // åº”ç”¨è¯­è¨€ï¼Œé»˜è®¤ä¸­æ–‡
        let calendarYear = new Date().getFullYear(); // å½“å‰æ—¥å†å¹´ä»½
        let calendarMonth = new Date().getMonth(); // å½“å‰æ—¥å†æœˆä»½
        let currentChallenge = null; // å½“å‰æŒ‘æˆ˜
        
        // åº”ç”¨è®¾ç½®
        let settings = {
            confettiEnabled: true,
            challengeEnabled: true,
            achievementsEnabled: true,
            gameStats: {
                level: 1,
                points: 0,
                nextLevelPoints: 100,
                streak: 0,
                longestStreak: 0,
                lastActivity: null,
                achievements: [],
                challengesCompleted: 0
            },
            ai: {
                enabled: false,
                provider: 'openai',
                apiKey: '',
                model: 'gpt-3.5-turbo',
                customModel: '',
                endpoint: ''
            }
        };
        
        // æŒ‘æˆ˜ç±»å‹
        const challengeTypes = [
            { 
                id: 'complete_tasks', 
                icon: 'ğŸš€', 
                getText: (count) => appLang === 'zh' ? 
                    `å®Œæˆ${count}ä¸ªä»»åŠ¡ï¼Œè·å¾—é¢å¤–${count * 5}ç§¯åˆ†` : 
                    `Complete ${count} tasks to earn ${count * 5} bonus points`,
                target: () => Math.floor(Math.random() * 3) + 2, // 2-4
                reward: (target) => target * 5
            },
            { 
                id: 'create_tasks', 
                icon: 'âœï¸', 
                getText: (count) => appLang === 'zh' ? 
                    `åˆ›å»º${count}ä¸ªæ–°ä»»åŠ¡ï¼Œè·å¾—é¢å¤–${count * 3}ç§¯åˆ†` : 
                    `Create ${count} new tasks to earn ${count * 3} bonus points`,
                target: () => Math.floor(Math.random() * 2) + 2, // 2-3
                reward: (target) => target * 3
            },
            { 
                id: 'detail_tasks', 
                icon: 'ğŸ“', 
                getText: (count) => appLang === 'zh' ? 
                    `æ·»åŠ ${count}ä¸ªå¸¦è¯¦ç»†æè¿°çš„ä»»åŠ¡ï¼Œè·å¾—é¢å¤–${count * 4}ç§¯åˆ†` : 
                    `Add ${count} tasks with detailed descriptions to earn ${count * 4} bonus points`,
                target: () => Math.floor(Math.random() * 2) + 1, // 1-2
                reward: (target) => target * 4
            }
        ];
        
        // æˆå°±æ•°æ®
        const achievements = [
            {
                id: 'first_task',
                name: { zh: 'ç¬¬ä¸€æ­¥', en: 'First Step' },
                description: { zh: 'åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡', en: 'Create your first task' },
                icon: 'ğŸŒ±',
                condition: (stats, tasks) => tasks.length > 0,
                points: 10
            },
            {
                id: 'task_master',
                name: { zh: 'ä»»åŠ¡è¾¾äºº', en: 'Task Master' },
                description: { zh: 'åˆ›å»º10ä¸ªä»»åŠ¡', en: 'Create 10 tasks' },
                icon: 'ğŸ“š',
                condition: (stats, tasks) => tasks.length >= 10,
                points: 20
            },
            {
                id: 'productivity_guru',
                name: { zh: 'æ•ˆç‡å¤§å¸ˆ', en: 'Productivity Guru' },
                description: { zh: 'å®Œæˆ20ä¸ªä»»åŠ¡', en: 'Complete 20 tasks' },
                icon: 'âš¡',
                condition: (stats, tasks) => tasks.filter(t => t.completed).length >= 20,
                points: 30
            },
            {
                id: 'detail_lover',
                name: { zh: 'ç»†èŠ‚æ§', en: 'Detail Lover' },
                description: { zh: 'åˆ›å»º5ä¸ªåŒ…å«é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆçš„ä»»åŠ¡', en: 'Create 5 tasks with problems and solutions' },
                icon: 'ğŸ”',
                condition: (stats, tasks) => tasks.filter(t => t.problem && t.solution && t.problem.length > 0 && t.solution.length > 0).length >= 5,
                points: 25
            },
            {
                id: 'streak_3',
                name: { zh: 'åšæŒä¸æ‡ˆ', en: 'Perseverance' },
                description: { zh: 'è¿ç»­3å¤©å®Œæˆä»»åŠ¡', en: 'Complete tasks for 3 consecutive days' },
                icon: 'ğŸ”¥',
                condition: (stats) => stats.streak >= 3,
                points: 15
            },
            {
                id: 'streak_7',
                name: { zh: 'ä¸€å‘¨ä¸æ–­', en: 'Week Strong' },
                description: { zh: 'è¿ç»­7å¤©å®Œæˆä»»åŠ¡', en: 'Complete tasks for 7 consecutive days' },
                icon: 'ğŸ“…',
                condition: (stats) => stats.streak >= 7,
                points: 30
            },
            {
                id: 'ai_explorer',
                name: { zh: 'AIæ¢ç´¢è€…', en: 'AI Explorer' },
                description: { zh: 'ä½¿ç”¨AIåŠ©æ‰‹è·å–5æ¬¡å»ºè®®', en: 'Get suggestions from AI Assistant 5 times' },
                icon: 'ğŸ¤–',
                condition: (stats) => stats.aiSuggestionsUsed >= 5,
                points: 25
            },
            {
                id: 'challenge_5',
                name: { zh: 'æŒ‘æˆ˜è€…', en: 'Challenger' },
                description: { zh: 'å®Œæˆ5ä¸ªæ—¥å¸¸æŒ‘æˆ˜', en: 'Complete 5 daily challenges' },
                icon: 'ğŸ…',
                condition: (stats) => stats.challengesCompleted >= 5,
                points: 35
            },
            {
                id: 'level_5',
                name: { zh: 'ç­‰çº§æå‡', en: 'Level Up' },
                description: { zh: 'è¾¾åˆ°5çº§', en: 'Reach level 5' },
                icon: 'â¬†ï¸',
                condition: (stats) => stats.level >= 5,
                points: 50
            }
        ];
        
        // æœˆä»½åç§°
        const monthNames = {
            zh: ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'],
            en: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
        };
        
        // æ˜ŸæœŸåç§°
        const weekdayNames = {
            zh: ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'],
            en: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
        };
        
        // æ˜ŸæœŸç®€ç§°
        const weekdayShort = {
            zh: ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'],
            en: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
        };
        
        // ==================== äº‹ä»¶ç›‘å¬å™¨ ====================
        // å¯¼èˆªæŒ‰é’®ç›‘å¬
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        document.getElementById('archive-button').addEventListener('click', showArchive);
        document.getElementById('habit-button').addEventListener('click', showHabitTracking);
        document.getElementById('stats-button').addEventListener('click', showStats);
        document.getElementById('search-button').addEventListener('click', showSearch);
        document.getElementById('settings-button').addEventListener('click', showSettings);
        document.getElementById('back-to-today').addEventListener('click', showToday);
        document.getElementById('back-from-search').addEventListener('click', showToday);
        document.getElementById('back-from-settings').addEventListener('click', showToday);
        document.getElementById('back-from-habit').addEventListener('click', showToday);
        document.getElementById('back-from-stats').addEventListener('click', showToday);
        document.getElementById('add-task-button').addEventListener('click', showAddTaskModal);
        document.getElementById('close-modal').addEventListener('click', closeModal);
        document.getElementById('cancel-task').addEventListener('click', closeModal);
        document.getElementById('close-ai-modal').addEventListener('click', closeAiModal);
        document.getElementById('logo-home-link').addEventListener('click', showToday);
        
        // æ¸¸æˆæ¨¡å¼æŒ‰é’®ç›‘å¬
        document.getElementById('game-mode-toggle').addEventListener('click', toggleGameMode);
        
        // æ—¥å†æ§åˆ¶æŒ‰é’®
        document.getElementById('prev-month').addEventListener('click', () => changeMonth(-1));
        document.getElementById('next-month').addEventListener('click', () => changeMonth(1));
        
        // è¡¨å•æäº¤ç›‘å¬
        taskForm.addEventListener('submit', handleTaskSubmit);
        
        // æœç´¢åŠŸèƒ½ç›‘å¬
        document.getElementById('search-execute').addEventListener('click', performSearch);
        document.getElementById('search-input').addEventListener('keypress', e => {
            if (e.key === 'Enter') performSearch();
        });
        
        // AIåŠŸèƒ½ç›‘å¬
        document.getElementById('ai-enabled').addEventListener('change', updateAiSetting);
        document.getElementById('api-provider').addEventListener('change', updateApiProviderUI);
        document.getElementById('ai-model').addEventListener('change', updateModelUI);
        document.getElementById('test-ai-connection').addEventListener('click', testAiConnection);
        document.getElementById('apply-ai-suggestions').addEventListener('click', applyAiSuggestions);
        
        // è®¾ç½®é¢æ¿ç›‘å¬
        document.getElementById('lang-zh').addEventListener('click', () => changeLanguage('zh'));
        document.getElementById('lang-en').addEventListener('click', () => changeLanguage('en'));
        document.getElementById('export-json').addEventListener('click', exportDataJson);
        document.getElementById('export-markdown').addEventListener('click', exportDataMarkdown);
        document.getElementById('import-data').addEventListener('click', () => document.getElementById('import-file').click());
        document.getElementById('import-file').addEventListener('change', importData);
        document.getElementById('challenge-enabled').addEventListener('change', updateChallengesSetting);
        document.getElementById('achievements-enabled').addEventListener('change', updateAchievementsSetting);
        document.getElementById('confetti-enabled').addEventListener('change', updateConfettiSetting);
        document.getElementById('reset-game-progress').addEventListener('click', resetGameProgress);
        document.getElementById('clear-all-data').addEventListener('click', clearAllData);
        
        // ==================== åˆå§‹åŒ– ====================
        initApp();
        
        /**
         * åˆå§‹åŒ–åº”ç”¨
         */
        function initApp() {
            // åŠ è½½è®¾ç½®å’Œä»»åŠ¡
            loadSettings();
            loadTasks();
            
            // è®¾ç½®ç•Œé¢è¯­è¨€ï¼ˆæ ¹æ®æµè§ˆå™¨è®¾ç½®æˆ–ç”¨æˆ·åå¥½ï¼‰
            detectBrowserLanguage();
            
            // æ›´æ–°ç•Œé¢å…ƒç´ 
            updateTodayDate();
            renderTodayTasks();
            
            // åˆå§‹åŒ–æ¸¸æˆç›¸å…³åŠŸèƒ½
            initializeGameFeatures();
            
            // æ ¹æ®è®¾ç½®åº”ç”¨æ¸¸æˆæ¨¡å¼
            if (gameMode) {
                enableGameMode();
            }
            
            // å¦‚æœå¯ç”¨äº†AIåŠ©æ‰‹
            if (settings.ai && settings.ai.enabled) {
                aiEnabled = true;
                document.getElementById('ai-enabled').checked = true;
            }
            
            // æ›´æ–°æŒ‘æˆ˜æ˜¾ç¤º
            if (gameMode && settings.challengeEnabled) {
                updateDailyChallenge();
            }
            
            // åº”ç”¨è®¾ç½®å€¼åˆ°ç•Œé¢
            applySettingsToUI();

            // æ¸…é™¤æ‰€æœ‰tooltip
            cleanupTooltips();
        }
        
        /**
         * æ¸…ç†æ‰€æœ‰æ‚¬æµ®å·¥å…·æç¤º
         */
        function cleanupTooltips() {
            // ç§»é™¤æ‰€æœ‰å·¥å…·æç¤ºçš„æ‚¬æµ®æ˜¾ç¤ºçŠ¶æ€
            document.querySelectorAll('.tooltip::before').forEach(el => {
                if (el.style.opacity === '1') {
                    el.style.opacity = '0';
                    el.style.visibility = 'hidden';
                }
            });
        }
        
        /**
         * å°†ä¿å­˜çš„è®¾ç½®åº”ç”¨åˆ°ç•Œé¢ä¸Š
         */
        function applySettingsToUI() {
            // æ¸¸æˆæ¨¡å¼è®¾ç½®
            document.getElementById('challenge-enabled').checked = settings.challengeEnabled;
            document.getElementById('achievements-enabled').checked = settings.achievementsEnabled;
            document.getElementById('confetti-enabled').checked = settings.confettiEnabled;
            
            // AIåŠ©æ‰‹è®¾ç½®
            document.getElementById('ai-enabled').checked = settings.ai.enabled;
            document.getElementById('api-provider').value = settings.ai.provider;
            document.getElementById('api-key').value = settings.ai.apiKey || '';
            document.getElementById('ai-model').value = settings.ai.model;
            
            if (settings.ai.endpoint) {
                document.getElementById('endpoint-url').value = settings.ai.endpoint;
            }
            
            if (settings.ai.customModel) {
                document.getElementById('custom-model').value = settings.ai.customModel;
            }
            
            // æ ¹æ®æä¾›å•†æ›´æ–°UI
            updateApiProviderUI();
            updateModelUI();
        }
        
        /**
         * æ£€æµ‹æµè§ˆå™¨è¯­è¨€å¹¶è®¾ç½®åº”ç”¨è¯­è¨€
         */
        function detectBrowserLanguage() {
            if (settings.language) {
                // å¦‚æœæœ‰ä¿å­˜çš„è¯­è¨€è®¾ç½®ï¼Œä¼˜å…ˆä½¿ç”¨
                appLang = settings.language;
                changeLanguage(appLang, false);
            } else {
                // å¦åˆ™æ£€æµ‹æµè§ˆå™¨è¯­è¨€
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.startsWith('zh')) {
                    changeLanguage('zh', false);
                } else {
                    changeLanguage('en', false);
                }
            }
        }
        
        /**
         * æ›´æ–°ä»Šæ—¥æ—¥æœŸæ˜¾ç¤º
         */
        function updateTodayDate() {
            const now = new Date();
            
            if (appLang === 'zh') {
                // ä¸­æ–‡æ—¥æœŸæ ¼å¼ï¼š2023å¹´6æœˆ15æ—¥ æ˜ŸæœŸå››
                const year = now.getFullYear();
                const month = now.getMonth() + 1;
                const day = now.getDate();
                const weekday = weekdayNames.zh[now.getDay()];
                
                todayDateEl.textContent = `${year}å¹´${month}æœˆ${day}æ—¥ ${weekday}`;
            } else {
                // è‹±æ–‡æ—¥æœŸæ ¼å¼ï¼šThursday, June 15, 2023
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                todayDateEl.textContent = now.toLocaleDateString('en-US', options);
            }
        }
        
        /**
         * åˆå§‹åŒ–æ¸¸æˆç›¸å…³åŠŸèƒ½
         */
        function initializeGameFeatures() {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦ç”Ÿæˆæ–°çš„æ¯æ—¥æŒ‘æˆ˜
            const today = new Date().toISOString().split('T')[0];
            if (!currentChallenge || currentChallenge.date !== today) {
                generateDailyChallenge();
            }
            
            // æ£€æŸ¥å¹¶æ›´æ–°è¿ç»­å®Œæˆè®°å½•
            updateStreak();
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ–°è§£é”çš„æˆå°±
            if (settings.achievementsEnabled) {
                checkAchievements();
            }
            
            // åˆå§‹åŒ–AIä½¿ç”¨è®¡æ•°
            if (!settings.gameStats.aiSuggestionsUsed) {
                settings.gameStats.aiSuggestionsUsed = 0;
            }
        }
        
        // ==================== å¯¼èˆªåŠŸèƒ½ ====================
        /**
         * æ˜¾ç¤ºä»Šæ—¥ä»»åŠ¡é¡µé¢
         */
        function showToday() {
            // éšè—å…¶ä»–å®¹å™¨
            archiveContainer.classList.add('hidden');
            searchContainer.classList.add('hidden');
            settingsContainer.classList.add('hidden');
            habitContainer.classList.add('hidden');
            statsContainer.classList.add('hidden');
            
            // æ˜¾ç¤ºä»Šæ—¥å®¹å™¨
            todayContainer.classList.remove('hidden');
            
            // æ›´æ–°ä»»åŠ¡æ˜¾ç¤º
            renderTodayTasks();

            // æ¸…ç†å·¥å…·æç¤º
            cleanupTooltips();
        }
        
        /**
         * æ˜¾ç¤ºå½’æ¡£é¡µé¢
         */
        function showArchive() {
            // éšè—å…¶ä»–å®¹å™¨
            todayContainer.classList.add('hidden');
            searchContainer.classList.add('hidden');
            settingsContainer.classList.add('hidden');
            habitContainer.classList.add('hidden');
            statsContainer.classList.add('hidden');
            
            // æ˜¾ç¤ºå½’æ¡£å®¹å™¨
            archiveContainer.classList.remove('hidden');
            
            // æ¸²æŸ“å½’æ¡£å†…å®¹
            renderArchiveYears();

            // æ¸…ç†å·¥å…·æç¤º
            cleanupTooltips();
        }
        
        /**
         * æ˜¾ç¤ºä¹ æƒ¯è¿½è¸ªé¡µé¢
         */
        function showHabitTracking() {
            // éšè—å…¶ä»–å®¹å™¨
            todayContainer.classList.add('hidden');
            archiveContainer.classList.add('hidden');
            searchContainer.classList.add('hidden');
            settingsContainer.classList.add('hidden');
            statsContainer.classList.add('hidden');
            
            // æ˜¾ç¤ºä¹ æƒ¯è¿½è¸ªå®¹å™¨
            habitContainer.classList.remove('hidden');
            
            // æ¸²æŸ“æ—¥å†è§†å›¾
            renderCalendar();
            updateHabitStatistics();

            // æ¸…ç†å·¥å…·æç¤º
            cleanupTooltips();
        }
        
        /**
         * æ˜¾ç¤ºç»Ÿè®¡åˆ†æé¡µé¢
         */
        function showStats() {
            // éšè—å…¶ä»–å®¹å™¨
            todayContainer.classList.add('hidden');
            archiveContainer.classList.add('hidden');
            searchContainer.classList.add('hidden');
            settingsContainer.classList.add('hidden');
            habitContainer.classList.add('hidden');
            
            // æ˜¾ç¤ºç»Ÿè®¡å®¹å™¨
            statsContainer.classList.remove('hidden');
            
            // æ¸²æŸ“ç»Ÿè®¡ä¿¡æ¯
            renderStatistics();

            // æ¸…ç†å·¥å…·æç¤º
            cleanupTooltips();
        }
        
        /**
         * æ˜¾ç¤ºæœç´¢é¡µé¢
         */
        function showSearch() {
            // éšè—å…¶ä»–å®¹å™¨
            todayContainer.classList.add('hidden');
            archiveContainer.classList.add('hidden');
            settingsContainer.classList.add('hidden');
            habitContainer.classList.add('hidden');
            statsContainer.classList.add('hidden');
            
            // æ˜¾ç¤ºæœç´¢å®¹å™¨
            searchContainer.classList.remove('hidden');
            
            // æ¸…ç©ºä¹‹å‰çš„æœç´¢ç»“æœ
            searchResultsContainer.innerHTML = '';
            document.getElementById('search-input').focus();

            // æ¸…ç†å·¥å…·æç¤º
            cleanupTooltips();
        }
        
        /**
         * æ˜¾ç¤ºè®¾ç½®é¡µé¢
         */
        function showSettings() {
            // éšè—å…¶ä»–å®¹å™¨
            todayContainer.classList.add('hidden');
            archiveContainer.classList.add('hidden');
            searchContainer.classList.add('hidden');
            habitContainer.classList.add('hidden');
            statsContainer.classList.add('hidden');
            
            // æ˜¾ç¤ºè®¾ç½®å®¹å™¨
            settingsContainer.classList.remove('hidden');
            
            // æ›´æ–°è®¾ç½®UI
            applySettingsToUI();

            // æ¸…ç†å·¥å…·æç¤º
            cleanupTooltips();
        }
        
        /**
         * åˆ‡æ¢æš—/äº®ä¸»é¢˜
         */
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');

            // æ¸…ç†å·¥å…·æç¤º
            cleanupTooltips();
        }
        
        // ==================== ä»»åŠ¡è¡¨å•åŠŸèƒ½ ====================
        /**
         * æ˜¾ç¤ºæ·»åŠ ä»»åŠ¡çš„æ¨¡æ€æ¡†
         */
        function showAddTaskModal() {
            modalTitle.textContent = appLang === 'zh' ? 'æ·»åŠ æ–°ä»»åŠ¡' : 'Add New Task';
            
            // ä¸ºç¿»è¯‘åšå‡†å¤‡ï¼Œæ›´æ–°data-å±æ€§
            modalTitle.setAttribute('data-zh', 'æ·»åŠ æ–°ä»»åŠ¡');
            modalTitle.setAttribute('data-en', 'Add New Task');
            
            // é‡ç½®è¡¨å•
            taskForm.reset();
            currentTaskId = null;
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            taskModal.classList.remove('hidden');
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            setTimeout(() => {
                modalDialog.classList.remove('modal-enter');
                modalDialog.classList.add('modal-enter-active');
            }, 10);
            
            // èšç„¦åˆ°æ ‡é¢˜è¾“å…¥æ¡†
            taskTitleInput.focus();

            // æ¸…ç†å·¥å…·æç¤º
            cleanupTooltips();
        }
        
        /**
         * æ˜¾ç¤ºç¼–è¾‘ä»»åŠ¡çš„æ¨¡æ€æ¡†
         * @param {string} taskId - è¦ç¼–è¾‘çš„ä»»åŠ¡ID
         */
        function showEditTaskModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // è®¾ç½®æ¨¡æ€æ¡†æ ‡é¢˜
            modalTitle.textContent = appLang === 'zh' ? 'ç¼–è¾‘ä»»åŠ¡' : 'Edit Task';
            
            // ä¸ºç¿»è¯‘åšå‡†å¤‡ï¼Œæ›´æ–°data-å±æ€§
            modalTitle.setAttribute('data-zh', 'ç¼–è¾‘ä»»åŠ¡');
            modalTitle.setAttribute('data-en', 'Edit Task');
            
            // å¡«å……è¡¨å•æ•°æ®
            taskTitleInput.value = task.title || '';
            taskProblemInput.value = task.problem || '';
            taskSolutionInput.value = task.solution || '';
            currentTaskId = taskId;
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            taskModal.classList.remove('hidden');
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            setTimeout(() => {
                modalDialog.classList.remove('modal-enter');
                modalDialog.classList.add('modal-enter-active');
            }, 10);
            
            // èšç„¦åˆ°æ ‡é¢˜è¾“å…¥æ¡†
            taskTitleInput.focus();

            // æ¸…ç†å·¥å…·æç¤º
            cleanupTooltips();
        }
        
        /**
         * å…³é—­æ¨¡æ€æ¡†
         */
        function closeModal() {
            // æ·»åŠ é€€åœºåŠ¨ç”»
            modalDialog.classList.remove('modal-enter-active');
            modalDialog.classList.add('modal-enter');
            
            // ç­‰å¾…åŠ¨ç”»å®Œæˆåéšè—æ¨¡æ€æ¡†
            setTimeout(() => {
                taskModal.classList.add('hidden');
            }, 200);
        }
        
        /**
         * å…³é—­AIå»ºè®®æ¨¡æ€æ¡†
         */
        function closeAiModal() {
            // æ·»åŠ é€€åœºåŠ¨ç”»
            aiModalDialog.classList.remove('modal-enter-active');
            aiModalDialog.classList.add('modal-enter');
            
            // ç­‰å¾…åŠ¨ç”»å®Œæˆåéšè—æ¨¡æ€æ¡†
            setTimeout(() => {
                aiModal.classList.add('hidden');
            }, 200);
        }
        
        /**
         * å¤„ç†ä»»åŠ¡è¡¨å•æäº¤
         * @param {Event} e - è¡¨å•æäº¤äº‹ä»¶
         */
        function handleTaskSubmit(e) {
            e.preventDefault();
            
            const title = taskTitleInput.value.trim();
            const problem = taskProblemInput.value.trim();
            const solution = taskSolutionInput.value.trim();
            
            // æ ‡é¢˜æ˜¯å”¯ä¸€å¿…å¡«é¡¹
            if (!title) return;
            
            const now = new Date();
            
            if (currentTaskId) {
                // ç¼–è¾‘ç°æœ‰ä»»åŠ¡
                const taskIndex = tasks.findIndex(t => t.id === currentTaskId);
                if (taskIndex > -1) {
                    tasks[taskIndex] = {
                        ...tasks[taskIndex],
                        title,
                        problem,
                        solution,
                        updatedAt: now.toISOString()
                    };
                    
                    // å¦‚æœåœ¨æ¸¸æˆæ¨¡å¼ä¸‹ç¼–è¾‘ä»»åŠ¡ï¼Œç»™äºˆå°‘é‡ç§¯åˆ†å¥–åŠ±
                    if (gameMode) {
                        addGamePoints(2, false);
                    }
                }
            } else {
                // æ·»åŠ æ–°ä»»åŠ¡
                const newTask = {
                    id: Date.now().toString(),
                    title,
                    problem,
                    solution,
                    completed: false,
                    createdAt: now.toISOString(),
                    updatedAt: now.toISOString(),
                    date: now.toISOString().split('T')[0],
                    year: now.getFullYear(),
                    month: now.getMonth()
                };
                tasks.push(newTask);
                
                // å¦‚æœåœ¨æ¸¸æˆæ¨¡å¼ä¸‹æ·»åŠ æ–°ä»»åŠ¡ï¼Œç»™äºˆç§¯åˆ†å¥–åŠ±
                if (gameMode) {
                    let points = 10;
                    
                    // å¦‚æœä»»åŠ¡æœ‰è¯¦ç»†æè¿°ï¼Œç»™äºˆé¢å¤–å¥–åŠ±
                    if (problem && problem.length > 10) points += 3;
                    if (solution && solution.length > 10) points += 3;
                    
                    addGamePoints(points, false);
                    
                    // æ›´æ–°æŒ‘æˆ˜è¿›åº¦
                    if (currentChallenge && currentChallenge.type === 'create_tasks') {
                        updateChallengeProgress(1);
                    }
                    
                    // å¦‚æœä»»åŠ¡æœ‰è¯¦ç»†æè¿°ï¼Œæ›´æ–°ç›¸å…³æŒ‘æˆ˜
                    if ((problem && problem.length > 10) || (solution && solution.length > 10)) {
                        if (currentChallenge && currentChallenge.type === 'detail_tasks') {
                            updateChallengeProgress(1);
                        }
                    }
                }
                
                // æ£€æŸ¥æˆå°±
                if (settings.achievementsEnabled) {
                    checkAchievements();
                }
            }
            
            // ä¿å­˜ä»»åŠ¡æ•°æ®
            saveTasks();
            
            // æ›´æ–°è§†å›¾
            if (todayContainer.classList.contains('hidden') === false) {
                renderTodayTasks();
            } else if (archiveContainer.classList.contains('hidden') === false) {
                renderArchivedTasks();
            } else if (searchContainer.classList.contains('hidden') === false) {
                performSearch();
            }
            
            // å¦‚æœå¯ç”¨äº†AIåŠ©æ‰‹ï¼Œå¹¶ä¸”ä»»åŠ¡æœ‰é—®é¢˜æè¿°ï¼Œæ˜¾ç¤ºAIå»ºè®®
            if (aiEnabled && problem && problem.length > 5) {
                showAiSuggestions(title, problem);
            }
            
            // å…³é—­æ¨¡æ€æ¡†
            closeModal();
        }
        
        // ==================== ä»»åŠ¡ç®¡ç†åŠŸèƒ½ ====================
        /**
         * ä»localStorageåŠ è½½ä»»åŠ¡æ•°æ®
         */
        function loadTasks() {
            const savedTasks = localStorage.getItem('auroraTasks_tasks');
            tasks = savedTasks ? JSON.parse(savedTasks) : [];
        }
        
        /**
         * ä¿å­˜ä»»åŠ¡æ•°æ®åˆ°localStorage
         */
        function saveTasks() {
            localStorage.setItem('auroraTasks_tasks', JSON.stringify(tasks));
        }
        
        /**
         * ä»localStorageåŠ è½½åº”ç”¨è®¾ç½®
         */
        function loadSettings() {
            const savedSettings = localStorage.getItem('auroraTasks_settings');
            if (savedSettings) {
                const parsedSettings = JSON.parse(savedSettings);
                settings = { ...settings, ...parsedSettings };
                
                // æ¢å¤æ¸¸æˆæ¨¡å¼çŠ¶æ€
                gameMode = parsedSettings.gameMode || false;
                
                // æ¢å¤è¯­è¨€è®¾ç½®
                if (parsedSettings.language) {
                    appLang = parsedSettings.language;
                }
                
                // æ¢å¤å½“å‰æŒ‘æˆ˜
                if (parsedSettings.currentChallenge) {
                    currentChallenge = parsedSettings.currentChallenge;
                }
            }
        }
        
        /**
         * ä¿å­˜åº”ç”¨è®¾ç½®åˆ°localStorage
         */
        function saveSettings() {
            const settingsToSave = {
                ...settings,
                gameMode,
                language: appLang,
                currentChallenge
            };
            localStorage.setItem('auroraTasks_settings', JSON.stringify(settingsToSave));
        }
        
        /**
         * æ›´æ–°ç‰¹æ•ˆè®¾ç½®
         */
        function updateConfettiSetting() {
            settings.confettiEnabled = document.getElementById('confetti-enabled').checked;
            saveSettings();
        }
        
        /**
         * æ›´æ–°æŒ‘æˆ˜è®¾ç½®
         */
        function updateChallengesSetting() {
            settings.challengeEnabled = document.getElementById('challenge-enabled').checked;
            saveSettings();
            
            // å¦‚æœå¯ç”¨äº†æŒ‘æˆ˜å¹¶ä¸”æ¸¸æˆæ¨¡å¼å·²å¼€å¯ï¼Œæ›´æ–°æŒ‘æˆ˜æ˜¾ç¤º
            if (settings.challengeEnabled && gameMode) {
                updateDailyChallenge();
            }
        }
        
        /**
         * æ›´æ–°æˆå°±ç³»ç»Ÿè®¾ç½®
         */
        function updateAchievementsSetting() {
            settings.achievementsEnabled = document.getElementById('achievements-enabled').checked;
            saveSettings();
            
            // å¦‚æœå¯ç”¨äº†æˆå°±ç³»ç»Ÿï¼Œæ£€æŸ¥æˆå°±
            if (settings.achievementsEnabled) {
                checkAchievements();
            }
        }
        
        /**
         * æ›´æ–°AIè®¾ç½®
         */
        function updateAiSetting() {
            aiEnabled = document.getElementById('ai-enabled').checked;
            settings.ai.enabled = aiEnabled;
            
            // æ˜¾ç¤ºæˆ–éšè—AIè®¾ç½®
            const aiSettings = document.getElementById('ai-settings');
            if (aiEnabled) {
                aiSettings.classList.remove('hidden');
            } else {
                aiSettings.classList.add('hidden');
            }
            
            saveSettings();
        }
        
        /**
         * æ›´æ–°APIæä¾›å•†UI
         */
        function updateApiProviderUI() {
            const provider = document.getElementById('api-provider').value;
            settings.ai.provider = provider;
            
            // æ˜¾ç¤ºæˆ–éšè—è‡ªå®šä¹‰ç«¯ç‚¹
            const customEndpointContainer = document.getElementById('custom-endpoint-container');
            if (provider === 'custom') {
                customEndpointContainer.classList.remove('hidden');
            } else {
                customEndpointContainer.classList.add('hidden');
            }
            
            // æ›´æ–°æ¨¡å‹é€‰æ‹©å™¨
            updateModelOptions(provider);
            
            saveSettings();
        }
        
        /**
         * æ ¹æ®æä¾›å•†æ›´æ–°æ¨¡å‹é€‰é¡¹
         * @param {string} provider - APIæä¾›å•†
         */
        function updateModelOptions(provider) {
            const modelSelect = document.getElementById('ai-model');
            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            modelSelect.innerHTML = '';
            
            // æ ¹æ®æä¾›å•†æ·»åŠ ç›¸åº”çš„æ¨¡å‹é€‰é¡¹
            if (provider === 'openai') {
                addOption(modelSelect, 'gpt-3.5-turbo', 'GPT-3.5 Turbo');
                addOption(modelSelect, 'gpt-4', 'GPT-4');
                addOption(modelSelect, 'gpt-4-turbo', 'GPT-4 Turbo');
            } else if (provider === 'anthropic') {
                addOption(modelSelect, 'claude-3-opus', 'Claude 3 Opus');
                addOption(modelSelect, 'claude-3-sonnet', 'Claude 3 Sonnet');
                addOption(modelSelect, 'claude-3-haiku', 'Claude 3 Haiku');
            } else if (provider === 'gemini') {
                addOption(modelSelect, 'gemini-pro', 'Gemini Pro');
                addOption(modelSelect, 'gemini-flash', 'Gemini Flash');
            } else if (provider === 'poe') {
                addOption(modelSelect, 'GPT-3.5-Turbo', 'GPT-3.5-Turbo (Poe)');
                addOption(modelSelect, 'Claude-3-Opus', 'Claude-3-Opus (Poe)');
                addOption(modelSelect, 'Claude-3-Sonnet', 'Claude-3-Sonnet (Poe)');
                addOption(modelSelect, 'GPT-4o', 'GPT-4o (Poe)');
                addOption(modelSelect, 'GPT-4-Turbo', 'GPT-4-Turbo (Poe)');
            }
            
            // æ‰€æœ‰æä¾›å•†éƒ½æ·»åŠ è‡ªå®šä¹‰é€‰é¡¹
            addOption(modelSelect, 'custom', 'è‡ªå®šä¹‰');
            
            // å¦‚æœè®¾ç½®ä¸­æœ‰ä¿å­˜çš„æ¨¡å‹å¹¶ä¸”è¯¥æ¨¡å‹åœ¨å½“å‰æä¾›å•†çš„é€‰é¡¹ä¸­ï¼Œé€‰æ‹©å®ƒ
            if (settings.ai.model) {
                const options = Array.from(modelSelect.options).map(opt => opt.value);
                if (options.includes(settings.ai.model)) {
                    modelSelect.value = settings.ai.model;
                } else {
                    // å¦‚æœä¿å­˜çš„æ¨¡å‹ä¸åœ¨å½“å‰æä¾›å•†çš„é€‰é¡¹ä¸­ï¼Œé€‰æ‹©è‡ªå®šä¹‰
                    modelSelect.value = 'custom';
                    document.getElementById('custom-model').value = settings.ai.model;
                    document.getElementById('custom-model-container').classList.remove('hidden');
                }
            }
        }
        
        /**
         * ä¸ºé€‰æ‹©å™¨æ·»åŠ é€‰é¡¹
         * @param {HTMLSelectElement} select - é€‰æ‹©å™¨å…ƒç´ 
         * @param {string} value - é€‰é¡¹å€¼
         * @param {string} text - é€‰é¡¹æ–‡æœ¬
         */
        function addOption(select, value, text) {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            select.appendChild(option);
        }
        
        /**
         * æ›´æ–°æ¨¡å‹UI
         */
        function updateModelUI() {
            const model = document.getElementById('ai-model').value;
            settings.ai.model = model;
            
            // æ˜¾ç¤ºæˆ–éšè—è‡ªå®šä¹‰æ¨¡å‹è¾“å…¥
            const customModelContainer = document.getElementById('custom-model-container');
            if (model === 'custom') {
                customModelContainer.classList.remove('hidden');
                
                // å¦‚æœæœ‰ä¿å­˜çš„è‡ªå®šä¹‰æ¨¡å‹åç§°ï¼Œæ˜¾ç¤ºå®ƒ
                if (settings.ai.customModel) {
                    document.getElementById('custom-model').value = settings.ai.customModel;
                }
            } else {
                customModelContainer.classList.add('hidden');
            }
            
            saveSettings();
        }
        
        /**
         * æµ‹è¯•AIè¿æ¥
         */
        function testAiConnection() {
            const provider = document.getElementById('api-provider').value;
            const apiKey = document.getElementById('api-key').value;
            const model = document.getElementById('ai-model').value;
            const customModel = document.getElementById('custom-model').value;
            const endpoint = document.getElementById('endpoint-url').value;
            
            // ä¿å­˜è®¾ç½®
            settings.ai.provider = provider;
            settings.ai.apiKey = apiKey;
            settings.ai.model = model === 'custom' ? customModel : model;
            settings.ai.customModel = customModel;
            settings.ai.endpoint = endpoint;
            saveSettings();
            
            // å¦‚æœä½¿ç”¨Poeï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨window.Poe API
            if (provider === 'poe') {
                if (window.Poe) {
                    alert(appLang === 'zh' ? 
                        'Poe API å¯ç”¨ï¼Œé…ç½®å·²ä¿å­˜ï¼' : 
                        'Poe API is available. Settings saved!');
                } else {
                    alert(appLang === 'zh' ? 
                        'æ— æ³•è®¿é—®Poe APIã€‚è¯·ç¡®ä¿æ‚¨åœ¨Poeå¹³å°ä¸Šè¿è¡Œæ­¤åº”ç”¨ã€‚' : 
                        'Cannot access Poe API. Make sure you are running this app on the Poe platform.');
                }
                return;
            }

            if (provider === 'openai' || provider === 'custom') {
                // æµ‹è¯•OpenAIè¿æ¥
                const url = provider === 'custom' ? endpoint : 'https://api.openai.com/v1/chat/completions';
                const useModel = model === 'custom' ? customModel : model;
                
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: useModel,
                        messages: [{role: "user", content: "Hello"}],
                        max_tokens: 5
                    })
                })
                .then(response => {
                    if (response.ok) {
                        alert(appLang === 'zh' ? 'è¿æ¥æˆåŠŸï¼' : 'Connection successful!');
                    } else {
                        response.json().then(errorData => {
                            alert(appLang === 'zh' ? 
                                `è¿æ¥å¤±è´¥: ${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}` : 
                                `Connection failed: ${errorData.error?.message || 'Unknown error'}`);
                        }).catch(() => {
                            alert(appLang === 'zh' ? 
                                `è¿æ¥å¤±è´¥: çŠ¶æ€ç  ${response.status}` : 
                                `Connection failed: Status code ${response.status}`);
                        });
                    }
                })
                .catch(error => {
                    alert(appLang === 'zh' ? 
                        `æ— æ³•è¿æ¥åˆ°API: ${error.message}` : 
                        `Could not connect to API: ${error.message}`);
                });
            } else {
                // å¯¹äºå…¶ä»–APIï¼Œç®€å•ä¿å­˜è®¾ç½®
                alert(appLang === 'zh' ? 
                    'è®¾ç½®å·²ä¿å­˜ã€‚æ— æ³•ç›´æ¥æµ‹è¯•éOpenAI APIã€‚' : 
                    'Settings saved. Cannot directly test non-OpenAI APIs.');
            }
        }
        
        /**
         * æ˜¾ç¤ºAIå»ºè®®
         * @param {string} title - ä»»åŠ¡æ ‡é¢˜
         * @param {string} problem - ä»»åŠ¡é—®é¢˜
         */
        async function showAiSuggestions(title, problem) {
            // æ£€æŸ¥AIè®¾ç½®æ˜¯å¦å®Œæ•´
            if (!settings.ai.enabled) {
                alert(appLang === 'zh' ? 
                    'AIåŠ©æ‰‹æœªå¯ç”¨ã€‚è¯·åœ¨è®¾ç½®ä¸­å¯ç”¨ã€‚' : 
                    'AI Assistant is not enabled. Please enable it in settings.');
                return;
            }
            
            if (settings.ai.provider !== 'poe' && (!settings.ai.apiKey || !settings.ai.model)) {
                alert(appLang === 'zh' ? 
                    'AIåŠ©æ‰‹è®¾ç½®ä¸å®Œæ•´ã€‚è¯·åœ¨è®¾ç½®ä¸­é…ç½®APIå¯†é’¥å’Œæ¨¡å‹ã€‚' : 
                    'AI Assistant settings are incomplete. Please configure API key and model in settings.');
                return;
            }
            
            // æ˜¾ç¤ºAIæ¨¡æ€æ¡†
            aiModal.classList.remove('hidden');
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('ai-loading').classList.remove('hidden');
                document.getElementById('ai-content').classList.add('hidden');
                
                let response;
                
                if (settings.ai.provider === 'poe') {
                    // Poe APIè°ƒç”¨
                    response = await fetchPoemAiResponse(title, problem);
                } else {
                    // æ ‡å‡†APIè°ƒç”¨
                    response = await fetchStandardAiResponse(title, problem);
                }
                
                // æ£€æŸ¥å“åº”æ˜¯å¦ä¸ºJSON
                try {
                    const jsonResponse = typeof response === 'string' ? JSON.parse(response) : response;
                    processAiResponse(jsonResponse);
                } catch (e) {
                    // å¤„ç†éJSONå“åº”
                    console.error('AIå“åº”è§£æé”™è¯¯:', e);
                    document.getElementById('ai-loading').classList.add('hidden');
                    document.getElementById('ai-content').classList.remove('hidden');
                    
                    const errorMsg = appLang === 'zh' ? 
                        'AIæœåŠ¡è¿”å›äº†éé¢„æœŸæ ¼å¼çš„å“åº”ã€‚è¯·æ£€æŸ¥APIè®¾ç½®æˆ–ç¨åå†è¯•ã€‚' : 
                        'AI service returned an unexpected response format. Please check API settings or try again later.';
                    
                    document.getElementById('ai-problem-analysis').innerHTML = `<p class="text-red-500">${errorMsg}</p>`;
                    document.getElementById('ai-solutions').innerHTML = '';
                    document.getElementById('ai-methods').innerHTML = '';
                    
                    // ç”Ÿæˆæ¨¡æ‹Ÿå“åº”ä½œä¸ºå¤‡ç”¨
                    processAiResponse(generateMockAiResponse(title, problem));
                }
            } catch (error) {
                console.error('AIè¯·æ±‚é”™è¯¯:', error);
                document.getElementById('ai-loading').classList.add('hidden');
                document.getElementById('ai-content').classList.remove('hidden');
                
                const errorMsg = appLang === 'zh' ? 
                    `AIè¯·æ±‚å¤±è´¥: ${error.message}` : 
                    `AI request failed: ${error.message}`;
                
                document.getElementById('ai-problem-analysis').innerHTML = `<p class="text-red-500">${errorMsg}</p>`;
                document.getElementById('ai-solutions').innerHTML = '';
                document.getElementById('ai-methods').innerHTML = '';
                
                // ç”Ÿæˆæ¨¡æ‹Ÿå“åº”ä½œä¸ºå¤‡ç”¨
                processAiResponse(generateMockAiResponse(title, problem));
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('ai-loading').classList.remove('hidden');
            document.getElementById('ai-content').classList.add('hidden');
            
            // æ·»åŠ å…¥åœºåŠ¨ç”»
            setTimeout(() => {
                aiModalDialog.classList.remove('modal-enter');
                aiModalDialog.classList.add('modal-enter-active');
            }, 10);
            
            try {
                let responseData;
                
                // æ ¹æ®é—®é¢˜ç”Ÿæˆæç¤º
                const prompt = `ä»»åŠ¡: ${title}\n\né—®é¢˜/éš¾ç‚¹: ${problem}\n\nè¯·æä¾›ä»¥ä¸‹å†…å®¹:\n1. é—®é¢˜åˆ†æ: ç®€è¦åˆ†ææ­¤é—®é¢˜çš„æ ¸å¿ƒæŒ‘æˆ˜å’Œå…³é”®ç‚¹\n2. æ¨èè§£å†³æ–¹æ¡ˆ: é’ˆå¯¹æ­¤é—®é¢˜çš„2-3ä¸ªå¯è¡Œè§£å†³æ–¹æ¡ˆ\n3. ç›¸å…³AIå…³é”®è¯: æä¾›5-8ä¸ªä¸æ­¤ä¸»é¢˜ç›¸å…³çš„AIå…³é”®è¯ï¼Œå¯ç”¨äºæœç´¢å’Œç ”ç©¶`;
                
                if (settings.ai.provider === 'poe' && window.Poe) {
                    // ä½¿ç”¨Poe API
                    try {
                        const model = settings.ai.model;
                        responseData = await callPoeApi(model, prompt);
                    } catch (error) {
                        throw new Error(`Poe APIé”™è¯¯: ${error.message}`);
                    }
                } else if (settings.ai.provider === 'openai' || settings.ai.provider === 'custom') {
                    // ä½¿ç”¨OpenAI API
                    const url = settings.ai.provider === 'custom' ? settings.ai.endpoint : 'https://api.openai.com/v1/chat/completions';
                    const model = settings.ai.model === 'custom' ? settings.ai.customModel : settings.ai.model;
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${settings.ai.apiKey}`
                        },
                        body: JSON.stringify({
                            model: model,
                            messages: [{role: "user", content: prompt}],
                            max_tokens: 1000
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `HTTPé”™è¯¯ ${response.status}`);
                    }
                    
                    const data = await response.json();
                    responseData = data.choices[0].message.content;
                } else {
                    // æ¨¡æ‹Ÿå…¶ä»–APIå“åº”
                    responseData = generateMockAiResponse(title, problem);
                }
                
                // å¤„ç†AIå“åº”
                processAiResponse(responseData);
                
                // åœ¨æ¸¸æˆæ¨¡å¼ä¸‹å¢åŠ AIä½¿ç”¨è®¡æ•°
                if (gameMode) {
                    if (!settings.gameStats.aiSuggestionsUsed) {
                        settings.gameStats.aiSuggestionsUsed = 0;
                    }
                    settings.gameStats.aiSuggestionsUsed++;
                    saveSettings();
                    
                    // æ£€æŸ¥ç›¸å…³æˆå°±
                    if (settings.achievementsEnabled) {
                        checkAchievements();
                    }
                }
            } catch (error) {
                // å¤„ç†é”™è¯¯
                document.getElementById('ai-loading').classList.add('hidden');
                document.getElementById('ai-content').classList.remove('hidden');
                
                document.getElementById('ai-problem-analysis').innerHTML = 
                    `<p class="text-red-500">${appLang === 'zh' ? 'è·å–AIå»ºè®®æ—¶å‡ºé”™' : 'Error getting AI suggestions'}: ${error.message}</p>`;
                document.getElementById('ai-solutions').innerHTML = 
                    `<p class="text-red-500">${appLang === 'zh' ? 'è¯·æ£€æŸ¥ä½ çš„APIè®¾ç½®å’Œç½‘ç»œè¿æ¥' : 'Please check your API settings and network connection'}</p>`;
                document.getElementById('ai-methods').innerHTML = "";
                
                console.error('AI request error:', error);
            }
        }
        
        /**
         * è°ƒç”¨Poe API
         * @param {string} model - æ¨¡å‹åç§°
         * @param {string} prompt - æç¤ºå†…å®¹
         * @returns {Promise<string>} AIå“åº”
         */
        async function callPoeApi(model, prompt) {
            return new Promise((resolve, reject) => {
                if (!window.Poe) {
                    reject(new Error('Poe API not available'));
                    return;
                }
                
                // æ³¨å†Œå¤„ç†å“åº”çš„å‡½æ•°
                const handlerId = `ai_handler_${Date.now()}`;
                
                window.Poe.registerHandler(handlerId, (result, context) => {
                    if (result.status === 'error') {
                        reject(new Error(result.statusText || 'Unknown error'));
                        return;
                    }
                    
                    if (result.status === 'complete') {
                        const response = result.responses[0];
                        resolve(response.content);
                    }
                });
                
                // å‘é€è¯·æ±‚åˆ°Poe
                window.Poe.sendUserMessage(`@${model} ${prompt}`, {
                    handler: handlerId,
                    stream: false,
                    openChat: false
                }).catch(error => {
                    reject(new Error(`Failed to send message: ${error.message}`));
                });
            });
        }
        
        /**
         * å¤„ç†AIå“åº”
         * @param {string} aiResponse - AIçš„æ–‡æœ¬å“åº”
         */
        function processAiResponse(aiResponse) {
            // è§£æå“åº”æ–‡æœ¬ï¼Œå°è¯•è¯†åˆ«å„ä¸ªéƒ¨åˆ†
            let problemAnalysis = '';
            let solutions = '';
            let methods = '';
            
            // ç®€å•çš„è§£ææ¨¡å¼ - æŸ¥æ‰¾å„éƒ¨åˆ†æ ‡é¢˜
            const analysisMatch = aiResponse.match(/(?:é—®é¢˜åˆ†æ|åˆ†æ|Problem Analysis)[\s\S]*?(?=(?:æ¨èè§£å†³æ–¹æ¡ˆ|è§£å†³æ–¹æ¡ˆ|Suggested Solutions|ç›¸å…³AIå…³é”®è¯|AIå…³é”®è¯|æ¨èAIå…³é”®è¯|Recommended AI Keywords|$))/i);
            if (analysisMatch) {
                problemAnalysis = analysisMatch[0].replace(/(?:é—®é¢˜åˆ†æ|åˆ†æ|Problem Analysis)[:\s]*/i, '').trim();
            }
            
            const solutionsMatch = aiResponse.match(/(?:æ¨èè§£å†³æ–¹æ¡ˆ|è§£å†³æ–¹æ¡ˆ|Suggested Solutions)[\s\S]*?(?=(?:ç›¸å…³AIå…³é”®è¯|AIå…³é”®è¯|æ¨èAIå…³é”®è¯|Recommended AI Keywords|$))/i);
            if (solutionsMatch) {
                solutions = solutionsMatch[0].replace(/(?:æ¨èè§£å†³æ–¹æ¡ˆ|è§£å†³æ–¹æ¡ˆ|Suggested Solutions)[:\s]*/i, '').trim();
            }
            
            const methodsMatch = aiResponse.match(/(?:ç›¸å…³AIå…³é”®è¯|AIå…³é”®è¯|æ¨èAIå…³é”®è¯|Recommended AI Keywords)[\s\S]*/i);
            if (methodsMatch) {
                methods = methodsMatch[0].replace(/(?:ç›¸å…³AIå…³é”®è¯|AIå…³é”®è¯|æ¨èAIå…³é”®è¯|Recommended AI Keywords)[:\s]*/i, '').trim();
            }
            
            // æ›´æ–°UI
            document.getElementById('ai-loading').classList.add('hidden');
            document.getElementById('ai-content').classList.remove('hidden');
            
            document.getElementById('ai-problem-analysis').innerHTML = 
                problemAnalysis ? `<p>${problemAnalysis.replace(/\n/g, '<br>')}</p>` : 
                `<p>${appLang === 'zh' ? 'æ— æ³•æå–é—®é¢˜åˆ†æ' : 'Could not extract problem analysis'}</p>`;
            
            document.getElementById('ai-solutions').innerHTML = 
                solutions ? `<p>${solutions.replace(/\n/g, '<br>')}</p>` : 
                `<p>${appLang === 'zh' ? 'æ— æ³•æå–è§£å†³æ–¹æ¡ˆå»ºè®®' : 'Could not extract solution suggestions'}</p>`;
            
            document.getElementById('ai-methods').innerHTML = 
                methods ? `<p>${methods.replace(/\n/g, '<br>')}</p>` : 
                `<p>${appLang === 'zh' ? 'æ— æ³•æå–AIå…³é”®è¯' : 'Could not extract AI keywords'}</p>`;
        }
        
        /**
         * ç”Ÿæˆæ¨¡æ‹Ÿçš„AIå“åº” (å½“APIä¸å¯ç”¨æ—¶)
         * @param {string} title - ä»»åŠ¡æ ‡é¢˜
         * @param {string} problem - ä»»åŠ¡é—®é¢˜
         * @returns {string} æ¨¡æ‹Ÿçš„AIå“åº”
         */
        function generateMockAiResponse(title, problem) {
            // æ ¹æ®é—®é¢˜æ˜¯å¦åŒ…å«AIç›¸å…³å…³é”®è¯ï¼Œç”Ÿæˆä¸åŒçš„å“åº”
            const isAiRelated = problem.toLowerCase().includes('ai') || 
                               problem.toLowerCase().includes('äººå·¥æ™ºèƒ½') || 
                               problem.toLowerCase().includes('æœºå™¨å­¦ä¹ ') ||
                               title.toLowerCase().includes('ai') ||
                               title.toLowerCase().includes('äººå·¥æ™ºèƒ½');
            
            if (isAiRelated) {
                return `é—®é¢˜åˆ†æ:
æ ¹æ®æ‚¨æä¾›çš„ä»»åŠ¡æè¿°ï¼Œæ‚¨æ­£åœ¨å¯»æ‰¾AIè‡ªåª’ä½“çš„é€‰é¢˜ï¼Œå¹¶ä¸”ç‰¹åˆ«å…³æ³¨é€šè¿‡æ•°æ®å¹³å°å’Œå¯¹æ ‡æ–¹å¼æ¥æ‰¾é€‰é¢˜ã€‚æ ¸å¿ƒå›°éš¾åœ¨äºä¸ç¡®å®šå…³äºAIçš„å“ªäº›å…³é”®è¯å¯ä»¥ä½œä¸ºé€‰é¢˜åŸºç¡€ã€‚è¿™æ˜¯å†…å®¹åˆ›ä½œä¸­çš„å¸¸è§æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯åœ¨AIè¿™æ ·å¿«é€Ÿå‘å±•ä¸”æœ¯è¯­ä¸°å¯Œçš„é¢†åŸŸã€‚

æ¨èè§£å†³æ–¹æ¡ˆ:
1. ä½¿ç”¨AIè¶‹åŠ¿åˆ†æå·¥å…·ï¼šå¯ä»¥åˆ©ç”¨Google Trendsã€BuzzSumoæˆ–Ahrefsç­‰å¹³å°ï¼Œåˆ†ææœ€è¿‘çƒ­é—¨çš„AIç›¸å…³è¯é¢˜å’Œæœç´¢è¯ã€‚è¿™äº›å·¥å…·å¯ä»¥æä¾›æ•°æ®æ”¯æŒï¼Œå¸®åŠ©äº†è§£ç›®æ ‡å—ä¼—å½“å‰æœ€å…³æ³¨çš„AIä¸»é¢˜ã€‚

2. ç«å“å†…å®¹åˆ†æï¼šå¯¹æ ‡è¡Œä¸šå†…æˆåŠŸçš„AIè‡ªåª’ä½“è´¦å·ï¼Œåˆ†æä»–ä»¬æœ€å—æ¬¢è¿çš„å†…å®¹ã€‚å¯ä»¥ä½¿ç”¨å·¥å…·è¿½è¸ªä»–ä»¬çš„å‘å¸ƒé¢‘ç‡ã€äº’åŠ¨ç‡å’Œè¯„è®ºï¼Œæ‰¾å‡ºå…±åŒæ¨¡å¼ã€‚

3. å»ºç«‹AIå…³é”®è¯åº“ï¼šç³»ç»Ÿæ€§åœ°æ”¶é›†å’Œåˆ†ç±»AIé¢†åŸŸçš„å…³é”®è¯ï¼ŒåŒ…æ‹¬æŠ€æœ¯æœ¯è¯­ã€åº”ç”¨åœºæ™¯å’Œè¡Œä¸šå½±å“ã€‚å¯ä»¥ä½¿ç”¨æ€ç»´å¯¼å›¾å·¥å…·ç»„ç»‡è¿™äº›å…³é”®è¯ï¼Œå½¢æˆé€‰é¢˜ç½‘ç»œã€‚

ç›¸å…³AIå…³é”®è¯:
1. ç”Ÿæˆå¼AI (Generative AI)
2. å¤§è¯­è¨€æ¨¡å‹ (LLM - Large Language Models)
3. AIåº”ç”¨è½åœ° (AI Implementation)
4. äººå·¥æ™ºèƒ½ä¼¦ç† (AI Ethics)
5. æœºå™¨å­¦ä¹ ç®—æ³• (Machine Learning Algorithms)
6. AIåˆ›ä¸šè¶‹åŠ¿ (AI Startup Trends)
7. è‡ªåŠ¨é©¾é©¶æŠ€æœ¯ (Autonomous Driving)
8. AIå†…å®¹åˆ›ä½œ (AI Content Creation)`;
            } else {
                // é€šç”¨å“åº”
                return `é—®é¢˜åˆ†æ:
æ ¹æ®æ‚¨æè¿°çš„ä»»åŠ¡"${title}"ï¼Œä¸»è¦å›°éš¾åœ¨äº"${problem.substring(0, 50)}..."ã€‚è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°æ•°æ®æ”¶é›†å’Œæœ‰æ•ˆåˆ†ææ–¹é¢çš„æŒ‘æˆ˜ï¼Œéœ€è¦ç³»ç»ŸåŒ–çš„æ–¹æ³•æ¥è§£å†³ã€‚

æ¨èè§£å†³æ–¹æ¡ˆ:
1. ç»“æ„åŒ–åˆ†æï¼šå°†é—®é¢˜æ‹†åˆ†ä¸ºæ›´å°çš„å¯ç®¡ç†éƒ¨åˆ†ï¼Œé€ä¸ªå‡»ç ´ã€‚å¯ä»¥ä½¿ç”¨æ€ç»´å¯¼å›¾æˆ–é¡¹ç›®ç®¡ç†å·¥å…·æ¥å¯è§†åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚

2. è®¾ç«‹æ˜ç¡®ç›®æ ‡ï¼šç¡®å®šå…·ä½“çš„æˆåŠŸæŒ‡æ ‡ï¼Œä½¿è§£å†³æ–¹æ¡ˆæ›´æœ‰é’ˆå¯¹æ€§ã€‚è¿™åŒ…æ‹¬è®¾å®šé‡åŒ–çš„ç›®æ ‡å’Œæ—¶é—´è¡¨ã€‚

3. èµ„æºä¼˜åŒ–ï¼šè¯„ä¼°å¯ç”¨èµ„æºå¹¶ç¡®å®šä¼˜å…ˆé¡ºåºï¼Œç¡®ä¿æœ€å¤§åŒ–æ•ˆç‡ã€‚è€ƒè™‘æ˜¯å¦éœ€è¦é¢å¤–çš„å·¥å…·æˆ–åä½œæ¥åŠ é€Ÿè¿›ç¨‹ã€‚

æ¨èAIå…³é”®è¯:
1. æ•°æ®åˆ†æ (Data Analysis)
2. æ•ˆç‡ä¼˜åŒ– (Efficiency Optimization)
3. é¡¹ç›®ç®¡ç† (Project Management)
4. èµ„æºåˆ†é… (Resource Allocation)
5. è§£å†³æ–¹æ¡ˆè®¾è®¡ (Solution Design)
6. æ€§èƒ½æŒ‡æ ‡ (Performance Metrics)
7. è‡ªåŠ¨åŒ–å·¥å…· (Automation Tools)`;
            }
        }
        
        /**
         * åº”ç”¨AIå»ºè®®åˆ°ä»»åŠ¡è¡¨å•
         */
        function applyAiSuggestions() {
            // è·å–å½“å‰ç¼–è¾‘çš„ä»»åŠ¡
            if (!currentTaskId) return;
            
            const taskIndex = tasks.findIndex(t => t.id === currentTaskId);
            if (taskIndex === -1) return;
            
            // æ›´æ–°è§£å†³æ–¹æ¡ˆï¼ˆå¦‚æœä¸ºç©ºï¼‰
            if (!tasks[taskIndex].solution || tasks[taskIndex].solution.trim() === '') {
                // è·å–AIæ¨èçš„è§£å†³æ–¹æ¡ˆ
                const aiSolutions = document.getElementById('ai-solutions').innerText;
                if (aiSolutions && !aiSolutions.includes('æ— æ³•æå–') && !aiSolutions.includes('Could not extract')) {
                    tasks[taskIndex].solution = aiSolutions;
                } else {
                    tasks[taskIndex].solution = appLang === 'zh' ? 
                        "æ ¹æ®AIå»ºè®®ï¼šç»“æ„åŒ–åˆ†æé—®é¢˜ï¼Œè®¾ç«‹æ˜ç¡®ç›®æ ‡ï¼Œä¼˜åŒ–èµ„æºåˆ†é…ã€‚" : 
                        "Based on AI suggestions: Use structured analysis, set clear goals, optimize resources.";
                }
            }
            
            // ä¿å­˜æ›´æ–°
            saveTasks();
            
            // å…³é—­AIæ¨¡æ€æ¡†
            closeAiModal();
            
            // å¦‚æœåœ¨æ¸¸æˆæ¨¡å¼ä¸‹ä½¿ç”¨AIå»ºè®®ï¼Œç»™äºˆå°‘é‡ç§¯åˆ†å¥–åŠ±
            if (gameMode) {
                addGamePoints(5, true);
            }
            
            // æ›´æ–°ä»»åŠ¡æ˜¾ç¤º
            renderTodayTasks();
        }
        
        /**
         * æ¸²æŸ“ä»Šæ—¥ä»»åŠ¡åˆ—è¡¨
         */
        function renderTodayTasks() {
            tasksContainer.innerHTML = '';
            
            const today = new Date().toISOString().split('T')[0];
            let todayTasks = tasks.filter(task => task.date === today);
            
            // æŒ‰å®ŒæˆçŠ¶æ€æ’åºï¼Œæœªå®Œæˆçš„åœ¨å‰é¢ï¼Œå·²å®Œæˆçš„åœ¨åé¢
            todayTasks.sort((a, b) => {
                if (a.completed === b.completed) {
                    // å¦‚æœå®ŒæˆçŠ¶æ€ç›¸åŒï¼ŒæŒ‰åˆ›å»ºæ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
                    return new Date(b.createdAt) - new Date(a.createdAt);
                }
                return a.completed ? 1 : -1; // æœªå®Œæˆçš„åœ¨å‰é¢
            });
            
            // æ›´æ–°ä»»åŠ¡è®¡æ•°
            if (appLang === 'zh') {
                tasksCountEl.textContent = `ä»Šæ—¥ ${todayTasks.length} ä¸ªä»»åŠ¡`;
            } else {
                tasksCountEl.textContent = `${todayTasks.length} task${todayTasks.length !== 1 ? 's' : ''} for today`;
            }
            
            // å¦‚æœæ²¡æœ‰ä»»åŠ¡ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
            if (todayTasks.length === 0) {
                tasksContainer.innerHTML = `
                    <div class="glass rounded-2xl p-6 text-center">
                        <p class="text-gray-500 dark:text-gray-400 mb-4">
                            ${appLang === 'zh' ? 'ä»Šæ—¥æš‚æ— ä»»åŠ¡' : 'No tasks for today'}
                        </p>
                        <button id="empty-add-task" class="text-aurora-500 dark:text-aurora-300">
                            <i class="fas fa-plus mr-1"></i> 
                            ${appLang === 'zh' ? 'æ·»åŠ ç¬¬ä¸€ä¸ªä»»åŠ¡' : 'Add your first task'}
                        </button>
                    </div>
                `;
                document.getElementById('empty-add-task').addEventListener('click', showAddTaskModal);
                return;
            }
            
            // æ¸²æŸ“æ¯ä¸ªä»»åŠ¡å¡ç‰‡
            todayTasks.forEach((task, index) => {
                const taskElement = createTaskElement(task, index);
                tasksContainer.appendChild(taskElement);
            });
        }
        
        /**
         * åˆ›å»ºä»»åŠ¡å¡ç‰‡å…ƒç´ 
         * @param {Object} task - ä»»åŠ¡å¯¹è±¡
         * @param {number} index - ä»»åŠ¡ç´¢å¼•ï¼ˆç”¨äºåŠ¨ç”»å»¶è¿Ÿï¼‰
         * @returns {HTMLElement} ä»»åŠ¡å¡ç‰‡å…ƒç´ 
         */
        function createTaskElement(task, index) {
            const taskDiv = document.createElement('div');
            taskDiv.className = `task-card glass rounded-2xl p-5 fade-in`;
            taskDiv.style.animationDelay = `${index * 0.05}s`;
            
            // æ·»åŠ ä»»åŠ¡å®ŒæˆçŠ¶æ€ç±»
            if (task.completed) {
                taskDiv.classList.add('bg-opacity-80', 'dark:bg-opacity-20');
            }
            
            // ä»»åŠ¡å›¾æ ‡ï¼ˆæ ¹æ®å®ŒæˆçŠ¶æ€ä¸åŒï¼‰
            const taskIcon = task.completed ? 
                `<i class="fas fa-check-circle text-aurora-500 dark:text-aurora-400"></i>` : 
                `<i class="far fa-circle text-gray-400"></i>`;
            
            // æ„å»ºä»»åŠ¡å¡ç‰‡HTML
            let taskHTML = `
                <div class="flex items-start">
                    <input type="checkbox" class="checkbox-custom mt-1" id="task-${task.id}" ${task.completed ? 'checked' : ''}>
                    <div class="ml-3 flex-1">
                        <h3 class="text-lg font-semibold ${task.completed ? 'line-through text-gray-500 dark:text-gray-400' : ''}">${task.title}</h3>
                        
                        <div class="mt-3 ${task.completed ? 'opacity-60' : ''}">
            `;
            
            // æ·»åŠ é—®é¢˜/éš¾ç‚¹ï¼ˆå¦‚æœæœ‰ï¼‰
            if (task.problem && task.problem.trim() !== '') {
                taskHTML += `
                    <div class="mb-3">
                        <p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-medium mb-1">${appLang === 'zh' ? 'é—®é¢˜/éš¾ç‚¹' : 'Problem/Challenge'}</p>
                        <p class="text-gray-700 dark:text-gray-300">${task.problem}</p>
                    </div>
                `;
            }
            
            // æ·»åŠ è§£å†³æ–¹æ¡ˆï¼ˆå¦‚æœæœ‰ï¼‰
            if (task.solution && task.solution.trim() !== '') {
                taskHTML += `
                    <div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 uppercase font-medium mb-1">${appLang === 'zh' ? 'è§£å†³æ–¹æ¡ˆ' : 'Solution'}</p>
                        <p class="text-gray-700 dark:text-gray-300">${task.solution}</p>
                    </div>
                `;
            }
            
            // æ·»åŠ AIåŠ©æ‰‹æŒ‰é’®ï¼ˆåªåœ¨AIå¯ç”¨ä¸”ä»»åŠ¡æœ‰é—®é¢˜æè¿°æ—¶æ˜¾ç¤ºï¼‰
            if (aiEnabled && task.problem && task.problem.trim() !== '' && !task.completed) {
                taskHTML += `
                    <div class="mt-3">
                        <button class="ai-help-btn text-sm px-3 py-1 rounded-lg bg-aurora-100 text-aurora-700 dark:bg-aurora-900 dark:text-aurora-300 hover:bg-aurora-200 dark:hover:bg-aurora-800 transition-colors" data-id="${task.id}">
                            <i class="fas fa-robot mr-1"></i> ${appLang === 'zh' ? 'AIåŠ©æ‰‹' : 'AI Assistant'}
                        </button>
                    </div>
                `;
            }
            
            // å®Œæˆä»»åŠ¡å¡ç‰‡HTML
            taskHTML += `
                        </div>
                    </div>
                    
                    <div class="flex flex-col space-y-2 ml-2">
                        <button class="task-edit text-gray-400 hover:text-gray-600 dark:hover:text-gray-200" data-id="${task.id}">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                        <button class="task-delete text-gray-400 hover:text-red-500" data-id="${task.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
            `;
            
            taskDiv.innerHTML = taskHTML;
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const checkbox = taskDiv.querySelector(`#task-${task.id}`);
            checkbox.addEventListener('change', () => toggleTaskCompletion(task.id, checkbox));
            
            const editBtn = taskDiv.querySelector('.task-edit');
            editBtn.addEventListener('click', () => showEditTaskModal(task.id));
            
            const deleteBtn = taskDiv.querySelector('.task-delete');
            deleteBtn.addEventListener('click', () => deleteTask(task.id));
            
            // æ·»åŠ AIåŠ©æ‰‹æŒ‰é’®ç›‘å¬å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const aiHelpBtn = taskDiv.querySelector('.ai-help-btn');
            if (aiHelpBtn) {
                aiHelpBtn.addEventListener('click', () => {
                    // è·å–ä»»åŠ¡ä¿¡æ¯
                    const taskData = tasks.find(t => t.id === task.id);
                    if (taskData) {
                        showAiSuggestions(taskData.title, taskData.problem);
                        currentTaskId = task.id; // è®¾ç½®å½“å‰ä»»åŠ¡IDä»¥ä¾¿åº”ç”¨å»ºè®®
                    }
                });
            }
            
            return taskDiv;
        }
        
        /**
         * åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
         * @param {string} taskId - ä»»åŠ¡ID
         * @param {HTMLElement} checkbox - å¤é€‰æ¡†å…ƒç´ 
         */
        function toggleTaskCompletion(taskId, checkbox) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            const wasCompleted = tasks[taskIndex].completed;
            const nowCompleted = !wasCompleted;
            
            // æ›´æ–°ä»»åŠ¡çŠ¶æ€
            tasks[taskIndex].completed = nowCompleted;
            tasks[taskIndex].completedAt = nowCompleted ? new Date().toISOString() : null;
            
            // ä¿å­˜ä»»åŠ¡æ•°æ®
            saveTasks();
            
            // å¦‚æœæ˜¯åˆšå®Œæˆä»»åŠ¡
            if (nowCompleted) {
                // ä¸ºå¤é€‰æ¡†æ·»åŠ åŠ¨ç”»
                checkbox.classList.add('task-complete-animation');
                setTimeout(() => checkbox.classList.remove('task-complete-animation'), 500);
                
                // åˆ›å»ºç¤¼èŠ±æ•ˆæœ
                if (settings.confettiEnabled) {
                    createConfetti(checkbox);
                }
                
                // æ¸¸æˆæ¨¡å¼å¥–åŠ±
                if (gameMode) {
                    addGamePoints(20);
                    
                    // æ›´æ–°æŒ‘æˆ˜è¿›åº¦
                    if (currentChallenge && currentChallenge.type === 'complete_tasks') {
                        updateChallengeProgress(1);
                    }
                }
                
                // æ›´æ–°è¿ç»­è®°å½•
                updateStreak();
                
                // å»¶è¿Ÿæ›´æ–°UIï¼Œä»¥ä¾¿åŠ¨ç”»å®Œæˆ
                setTimeout(() => {
                    // æ›´æ–°è§†å›¾
                    if (todayContainer.classList.contains('hidden') === false) {
                        renderTodayTasks();
                    } else if (archiveContainer.classList.contains('hidden') === false) {
                        renderArchivedTasks();
                    } else if (searchContainer.classList.contains('hidden') === false) {
                        performSearch();
                    }
                }, 600);
            } else {
                // å¦‚æœæ˜¯å–æ¶ˆå®Œæˆï¼Œç«‹å³æ›´æ–°UI
                if (gameMode) {
                    // æ¸¸æˆæ¨¡å¼å‡å°‘ç§¯åˆ†
                    addGamePoints(-10, false);
                    
                    // å¦‚æœå–æ¶ˆå®Œæˆäº†æŒ‘æˆ˜ç›¸å…³çš„ä»»åŠ¡ï¼Œæ›´æ–°æŒ‘æˆ˜
                    if (currentChallenge && currentChallenge.type === 'complete_tasks') {
                        updateChallengeProgress(-1);
                    }
                }
                
                // æ›´æ–°è¿ç»­è®°å½•
                updateStreak();
                
                // æ›´æ–°è§†å›¾
                if (todayContainer.classList.contains('hidden') === false) {
                    renderTodayTasks();
                } else if (archiveContainer.classList.contains('hidden') === false) {
                    renderArchivedTasks();
                } else if (searchContainer.classList.contains('hidden') === false) {
                    performSearch();
                }
            }
        }
        
        /**
         * åˆ é™¤ä»»åŠ¡
         * @param {string} taskId - ä»»åŠ¡ID
         */
        function deleteTask(taskId) {
            const taskToDelete = tasks.find(t => t.id === taskId);
            
            if (!confirm(appLang === 'zh' ? 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ' : 'Are you sure you want to delete this task?')) {
                return;
            }
            
            // ä»ä»»åŠ¡æ•°ç»„ä¸­ç§»é™¤ä»»åŠ¡
            tasks = tasks.filter(t => t.id !== taskId);
            
            // ä¿å­˜ä»»åŠ¡æ•°æ®
            saveTasks();
            
            // å¦‚æœåœ¨æ¸¸æˆæ¨¡å¼ä¸‹ï¼Œä¸”åˆ é™¤çš„æ˜¯å·²å®Œæˆä»»åŠ¡ï¼Œå‡å°‘ç§¯åˆ†
            if (gameMode && taskToDelete && taskToDelete.completed) {
                addGamePoints(-5, false);
                
                // å¦‚æœåˆ é™¤çš„æ˜¯ä¸æŒ‘æˆ˜ç›¸å…³çš„å·²å®Œæˆä»»åŠ¡ï¼Œæ›´æ–°æŒ‘æˆ˜è¿›åº¦
                if (currentChallenge && currentChallenge.type === 'complete_tasks' && taskToDelete.completed) {
                    updateChallengeProgress(-1);
                }
            }
            
            // æ›´æ–°è¿ç»­è®°å½•ï¼ˆå¦‚æœåˆ é™¤çš„æ˜¯ä»Šå¤©çš„å·²å®Œæˆä»»åŠ¡ï¼‰
            if (taskToDelete && taskToDelete.completed) {
                const today = new Date().toISOString().split('T')[0];
                if (taskToDelete.date === today) {
                    updateStreak();
                }
            }
            
            // æ›´æ–°è§†å›¾
            if (todayContainer.classList.contains('hidden') === false) {
                renderTodayTasks();
            } else if (archiveContainer.classList.contains('hidden') === false) {
                renderArchivedTasks();
            } else if (searchContainer.classList.contains('hidden') === false) {
                performSearch();
            }
        }
        
        // ==================== å½’æ¡£åŠŸèƒ½ ====================
        /**
         * æ¸²æŸ“å½’æ¡£å¹´ä»½é€‰é¡¹
         */
        function renderArchiveYears() {
            // è·å–ä»»åŠ¡ä¸­çš„å”¯ä¸€å¹´ä»½
            const years = [...new Set(tasks.map(task => task.year))].sort((a, b) => b - a);
            
            if (!currentYear && years.length > 0) {
                currentYear = years[0];
            }
            
            yearsTabsEl.innerHTML = '';
            
            years.forEach(year => {
                const yearTab = document.createElement('button');
                yearTab.className = `px-4 py-2 mr-2 mb-2 rounded-xl ${currentYear === year ? 'bg-aurora-500 text-white' : 'glass'}`;
                yearTab.textContent = year;
                yearTab.addEventListener('click', () => {
                    currentYear = year;
                    renderArchiveYears();
                    renderArchiveMonths();
                });
                
                yearsTabsEl.appendChild(yearTab);
            });
            
            renderArchiveMonths();
        }
        
        /**
         * æ¸²æŸ“å½’æ¡£æœˆä»½é€‰é¡¹
         */
        function renderArchiveMonths() {
            if (!currentYear) return;
            
            // è·å–å½“å‰å¹´ä»½çš„ä»»åŠ¡
            const yearTasks = tasks.filter(task => task.year === currentYear);
            
            // è·å–è¿™äº›ä»»åŠ¡ä¸­çš„å”¯ä¸€æœˆä»½
            const months = [...new Set(yearTasks.map(task => task.month))].sort((a, b) => a - b);
            
            if (!currentMonth && months.length > 0) {
                currentMonth = months[months.length - 1]; // é»˜è®¤é€‰æ‹©æœ€è¿‘çš„æœˆä»½
            }
            
            monthsTabsEl.innerHTML = '';
            
            months.forEach(month => {
                const monthTab = document.createElement('button');
                monthTab.className = `px-4 py-2 mr-2 mb-2 rounded-xl ${currentMonth === month ? 'bg-aurora-500 text-white' : 'glass'}`;
                monthTab.textContent = appLang === 'zh' ? monthNames.zh[month] : monthNames.en[month];
                monthTab.addEventListener('click', () => {
                    currentMonth = month;
                    renderArchiveMonths();
                    renderArchivedTasks();
                });
                
                monthsTabsEl.appendChild(monthTab);
            });
            
            renderArchivedTasks();
        }
        
        /**
         * æ¸²æŸ“å½’æ¡£ä»»åŠ¡åˆ—è¡¨
         */
        function renderArchivedTasks() {
            if (currentYear === null || currentMonth === null) return;
            
            archivedTasksContainer.innerHTML = '';
            
            // è·å–å½“å‰å¹´æœˆçš„ä»»åŠ¡
            const filteredTasks = tasks.filter(task => 
                task.year === currentYear && 
                task.month === currentMonth
            ).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            // å¦‚æœæ²¡æœ‰ä»»åŠ¡ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
            if (filteredTasks.length === 0) {
                archivedTasksContainer.innerHTML = `
                    <div class="glass rounded-2xl p-6 text-center">
                        <p class="text-gray-500 dark:text-gray-400">
                            ${appLang === 'zh' ? 'è¯¥æ—¶æœŸæ²¡æœ‰ä»»åŠ¡è®°å½•' : 'No tasks found for this period'}
                        </p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ—¥æœŸåˆ†ç»„ä»»åŠ¡
            const tasksByDate = {};
            filteredTasks.forEach(task => {
                const date = task.date;
                if (!tasksByDate[date]) {
                    tasksByDate[date] = [];
                }
                tasksByDate[date].push(task);
            });
            
            // æŒ‰æ—¥æœŸé™åºæ’åº
            const sortedDates = Object.keys(tasksByDate).sort((a, b) => new Date(b) - new Date(a));
            
            // æ¸²æŸ“æ¯ä¸ªæ—¥æœŸçš„ä»»åŠ¡ç»„
            sortedDates.forEach(date => {
                const dateObj = new Date(date);
                let formattedDate;
                
                if (appLang === 'zh') {
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    const weekday = weekdayNames.zh[dateObj.getDay()];
                    formattedDate = `${month}æœˆ${day}æ—¥ ${weekday}`;
                } else {
                    formattedDate = dateObj.toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        month: 'long', 
                        day: 'numeric'
                    });
                }
                
                // åˆ›å»ºæ—¥æœŸæ ‡é¢˜
                const dateHeader = document.createElement('div');
                dateHeader.className = 'mb-3 mt-6 first:mt-0';
                dateHeader.innerHTML = `<h3 class="text-lg font-semibold">${formattedDate}</h3>`;
                archivedTasksContainer.appendChild(dateHeader);
                
                // å¯¹æ¯ä¸ªæ—¥æœŸçš„ä»»åŠ¡æŒ‰å®ŒæˆçŠ¶æ€æ’åº
                tasksByDate[date].sort((a, b) => {
                    if (a.completed === b.completed) {
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    }
                    return a.completed ? 1 : -1; // æœªå®Œæˆçš„åœ¨å‰é¢
                });
                
                // æ¸²æŸ“è¯¥æ—¥æœŸçš„æ‰€æœ‰ä»»åŠ¡
                tasksByDate[date].forEach((task, index) => {
                    const taskElement = createTaskElement(task, index);
                    archivedTasksContainer.appendChild(taskElement);
                });
            });
        }
        
        // ==================== æ—¥å†å’Œä¹ æƒ¯è¿½è¸ªåŠŸèƒ½ ====================
        /**
         * æ¸²æŸ“æ—¥å†è§†å›¾
         */
        function renderCalendar() {
            const calendarTitle = document.getElementById('calendar-month-title');
            const calendarGrid = document.getElementById('calendar-grid');
            
            // è®¾ç½®æœˆä»½æ ‡é¢˜
            if (appLang === 'zh') {
                calendarTitle.textContent = `${calendarYear}å¹´${monthNames.zh[calendarMonth]}`;
            } else {
                calendarTitle.textContent = `${monthNames.en[calendarMonth]} ${calendarYear}`;
            }
            
            // æ¸…ç©ºæ—¥å†ç½‘æ ¼
            calendarGrid.innerHTML = '';
            
            // è·å–æœˆä»½çš„ç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
            const firstDay = new Date(calendarYear, calendarMonth, 1);
            const lastDay = new Date(calendarYear, calendarMonth + 1, 0);
            
            // è·å–æœˆä»½ç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡  (0-6ï¼Œæ˜ŸæœŸæ—¥-æ˜ŸæœŸå…­)
            const firstDayOfWeek = firstDay.getDay();
            
            // åˆ›å»ºä¸Šä¸ªæœˆçš„å ä½ç¬¦
            for (let i = 0; i < firstDayOfWeek; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day opacity-30 bg-gray-200 dark:bg-gray-800';
                calendarGrid.appendChild(dayElement);
            }
            
            // åˆ›å»ºå½“æœˆçš„æ—¥æœŸ
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(calendarYear, calendarMonth, day);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day bg-gray-200 dark:bg-gray-800';
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
                const isToday = dateStr === new Date().toISOString().split('T')[0];
                if (isToday) {
                    dayElement.classList.add('ring-2', 'ring-aurora-500');
                }
                
                // æ·»åŠ æ—¥æœŸç¼–å·
                dayElement.innerHTML = `<div class="day-number">${day}</div>`;
                
                // æ£€æŸ¥å½“å¤©çš„ä»»åŠ¡å®ŒæˆçŠ¶æ€
                const dayTasks = tasks.filter(task => task.date === dateStr);
                const completedTasks = dayTasks.filter(task => task.completed);
                
                // è®¾ç½®æ ¹æ®ä»»åŠ¡å®ŒæˆçŠ¶æ€çš„èƒŒæ™¯é¢œè‰²
                if (dayTasks.length > 0) {
                    const completionRate = completedTasks.length / dayTasks.length;
                    
                    if (completionRate === 1) {
                        // å…¨éƒ¨å®Œæˆ - ç»¿è‰²
                        dayElement.classList.remove('bg-gray-200', 'dark:bg-gray-800');
                        dayElement.classList.add('bg-green-500', 'dark:bg-green-600', 'text-white');
                    } else if (completionRate > 0) {
                        // éƒ¨åˆ†å®Œæˆ - æ ¹æ®å®Œæˆç‡è®¾ç½®é»„è‰²æ·±æµ…
                        dayElement.classList.remove('bg-gray-200', 'dark:bg-gray-800');
                        dayElement.style.backgroundColor = `rgba(245, 158, 11, ${0.4 + completionRate * 0.6})`; // é»„è‰²
                        if (completionRate >= 0.5) dayElement.classList.add('text-white');
                    } else {
                        // æ²¡æœ‰å®Œæˆ - çº¢è‰²
                        dayElement.classList.remove('bg-gray-200', 'dark:bg-gray-800');
                        dayElement.classList.add('bg-red-500', 'dark:bg-red-600', 'text-white');
                    }
                    
                    // æ·»åŠ ä»»åŠ¡æ•°é‡æç¤º
                    dayElement.setAttribute('data-tooltip', 
                        `${completedTasks.length}/${dayTasks.length} ${appLang === 'zh' ? 'ä»»åŠ¡å·²å®Œæˆ' : 'tasks completed'}`);
                    dayElement.classList.add('tooltip');
                }
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                dayElement.addEventListener('click', () => {
                    if (dayTasks.length > 0) {
                        alert(`${dateStr}: ${completedTasks.length}/${dayTasks.length} ${appLang === 'zh' ? 'ä»»åŠ¡å·²å®Œæˆ' : 'tasks completed'}`);
                    } else {
                        alert(appLang === 'zh' ? `${dateStr}: æ— ä»»åŠ¡` : `${dateStr}: No tasks`);
                    }
                });
                
                calendarGrid.appendChild(dayElement);
            }
            
            // å¡«å……å‰©ä½™çš„ç½‘æ ¼ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
            const totalDaysDisplayed = firstDayOfWeek + lastDay.getDate();
            const totalCells = Math.ceil(totalDaysDisplayed / 7) * 7;
            
            for (let i = totalDaysDisplayed; i < totalCells; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day opacity-30 bg-gray-200 dark:bg-gray-800';
                calendarGrid.appendChild(dayElement);
            }
        }
        
        /**
         * æ”¹å˜æ—¥å†æœˆä»½
         * @param {number} delta - æœˆä»½å˜åŒ–é‡ï¼ˆ+1æˆ–-1ï¼‰
         */
        function changeMonth(delta) {
            // æ›´æ–°æœˆä»½ï¼Œå¹¶å¤„ç†è·¨å¹´çš„æƒ…å†µ
            calendarMonth += delta;
            if (calendarMonth < 0) {
                calendarMonth = 11;
                calendarYear--;
            } else if (calendarMonth > 11) {
                calendarMonth = 0;
                calendarYear++;
            }
            
            // é‡æ–°æ¸²æŸ“æ—¥å†
            renderCalendar();
            updateHabitStatistics();
        }
        
        /**
         * æ›´æ–°ä¹ æƒ¯è¿½è¸ªç»Ÿè®¡ä¿¡æ¯
         */
        function updateHabitStatistics() {
            // è·å–å½“æœˆçš„ç»Ÿè®¡ä¿¡æ¯
            const startOfMonth = new Date(calendarYear, calendarMonth, 1).toISOString().split('T')[0];
            const endOfMonth = new Date(calendarYear, calendarMonth + 1, 0).toISOString().split('T')[0];
            
            // æŒ‰æ—¥æœŸç­›é€‰å½“æœˆä»»åŠ¡
            const monthTasks = tasks.filter(task => 
                task.date >= startOfMonth && task.date <= endOfMonth
            );
            
            // è®¡ç®—å®Œæˆç‡
            const totalTasks = monthTasks.length;
            const completedTasks = monthTasks.filter(task => task.completed).length;
            const completionRate = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
            
            // æ›´æ–°å®Œæˆç‡æ˜¾ç¤º
            document.getElementById('monthly-completion-rate').textContent = `${Math.round(completionRate)}%`;
            document.getElementById('monthly-completion-bar').style.width = `${completionRate}%`;
            
            // æ›´æ–°ä»»åŠ¡åˆ†å¸ƒ
            const activeTasks = tasks.filter(task => !task.completed).length;
            document.getElementById('completed-count').textContent = appLang === 'zh' ? 
                `${completedTasks} å·²å®Œæˆ` : 
                `${completedTasks} completed`;
            document.getElementById('active-count').textContent = appLang === 'zh' ? 
                `${activeTasks} è¿›è¡Œä¸­` : 
                `${activeTasks} active`;
            
            // æ›´æ–°è¿ç»­å®Œæˆè®°å½•
            const currentStreak = settings.gameStats.streak || 0;
            const longestStreak = settings.gameStats.longestStreak || 0;
            
            document.getElementById('longest-streak').textContent = appLang === 'zh' ? 
                `${longestStreak}å¤©` : 
                `${longestStreak} days`;
            
            // è®¾ç½®è¿ç»­å®Œæˆæ—¥æœŸè¯´æ˜
            if (longestStreak > 0) {
                const streakText = appLang === 'zh' ? 
                    `æœ€è¿‘è®°å½•ï¼š${currentStreak}å¤©` : 
                    `Current streak: ${currentStreak} days`;
                document.getElementById('streak-dates').textContent = streakText;
            } else {
                document.getElementById('streak-dates').textContent = appLang === 'zh' ? 
                    'æ— è®°å½•' : 'No streak';
            }
            
            // æ›´æ–°æœ¬å‘¨è¿›åº¦
            updateWeeklyProgress();
        }
        
        /**
         * æ›´æ–°æœ¬å‘¨è¿›åº¦æ¡
         */
        function updateWeeklyProgress() {
            // è·å–æœ¬å‘¨çš„æ—¥æœŸèŒƒå›´
            const today = new Date();
            const currentDay = today.getDay(); // 0-6 (æ˜ŸæœŸæ—¥-æ˜ŸæœŸå…­)
            
            // è®¡ç®—æœ¬å‘¨å¼€å§‹æ—¥æœŸï¼ˆæ˜ŸæœŸæ—¥ï¼‰
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - currentDay);
            
            // å¾ªç¯è·å–æœ¬å‘¨æ¯å¤©çš„çŠ¶æ€
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                
                // è·å–å½“å¤©çš„ä»»åŠ¡
                const dayTasks = tasks.filter(task => task.date === dateStr);
                const completedTasks = dayTasks.filter(task => task.completed);
                
                // è·å–å¯¹åº”çš„æ˜ŸæœŸå…ƒç´ 
                const dayElement = document.querySelector(`.weekly-day[data-day="${i}"]`);
                
                // è®¾ç½®é¢œè‰²
                if (dayTasks.length === 0) {
                    // æ— ä»»åŠ¡
                    dayElement.className = 'weekly-day h-8 rounded bg-gray-200 dark:bg-gray-700';
                } else if (completedTasks.length === dayTasks.length) {
                    // å…¨éƒ¨å®Œæˆ
                    dayElement.className = 'weekly-day h-8 rounded bg-green-500';
                } else if (completedTasks.length > 0) {
                    // éƒ¨åˆ†å®Œæˆ
                    dayElement.className = 'weekly-day h-8 rounded bg-yellow-500';
                } else {
                    // å…¨éƒ¨æœªå®Œæˆ
                    dayElement.className = 'weekly-day h-8 rounded bg-red-500';
                }
                
                // ä»Šå¤©çš„ç‰¹æ®Šæ ‡è®°
                if (dateStr === today.toISOString().split('T')[0]) {
                    dayElement.classList.add('ring-2', 'ring-aurora-500');
                }
                
                // æ·»åŠ æç¤º
                dayElement.setAttribute('data-tooltip', 
                    `${weekdayShort[appLang][i]}: ${completedTasks.length}/${dayTasks.length}`);
                dayElement.classList.add('tooltip');
            }
        }
        
        // ==================== ç»Ÿè®¡åŠŸèƒ½ ====================
        /**
         * æ¸²æŸ“ç»Ÿè®¡æ•°æ®
         */
        function renderStatistics() {
            // ä»»åŠ¡æ€»æ•°
            const totalTasks = tasks.length;
            document.getElementById('total-tasks-count').textContent = totalTasks;
            
            // å®Œæˆç‡
            const completedTasks = tasks.filter(task => task.completed).length;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            document.getElementById('completion-rate').textContent = `${completionRate}%`;
            
            // å¹³å‡æ¯æ—¥ä»»åŠ¡
            const uniqueDates = new Set(tasks.map(task => task.date));
            const daysWithTasks = uniqueDates.size;
            const dailyAverage = daysWithTasks > 0 ? Math.round(totalTasks / daysWithTasks * 10) / 10 : 0;
            document.getElementById('daily-average').textContent = dailyAverage;
            
            // è¿ç»­è®°å½•
            const currentStreak = settings.gameStats.streak || 0;
            const longestStreak = settings.gameStats.longestStreak || 0;
            document.getElementById('current-streak').textContent = currentStreak;
            document.getElementById('best-streak').querySelector('span:nth-child(2)').textContent = longestStreak;
            
            // æœ€é«˜æ•ˆæ—¥æ’è¡Œ
            renderProductiveDays();
            
            // æˆå°±å±•ç¤º
            renderAchievements();
        }
        
        /**
         * æ¸²æŸ“æœ€é«˜æ•ˆæ—¥æœŸåˆ—è¡¨
         */
        function renderProductiveDays() {
            const productiveDaysList = document.getElementById('productive-days-list');
            productiveDaysList.innerHTML = '';
            
            // æŒ‰æ—¥æœŸåˆ†ç»„ä»»åŠ¡
            const tasksByDate = {};
            tasks.forEach(task => {
                if (!tasksByDate[task.date]) {
                    tasksByDate[task.date] = {
                        total: 0,
                        completed: 0
                    };
                }
                tasksByDate[task.date].total++;
                if (task.completed) {
                    tasksByDate[task.date].completed++;
                }
            });
            
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
            const datesArray = Object.keys(tasksByDate).map(date => ({
                date,
                ...tasksByDate[date],
                completionRate: tasksByDate[date].total > 0 ? 
                    tasksByDate[date].completed / tasksByDate[date].total : 0
            }));
            
            // é¦–å…ˆæŒ‰å®Œæˆä»»åŠ¡æ•°é‡é™åºæ’åº
            datesArray.sort((a, b) => b.completed - a.completed);
            
            // åªå–å‰5ä¸ª
            const topDays = datesArray.slice(0, 5);
            
            // æ¸²æŸ“åˆ—è¡¨
            topDays.forEach(day => {
                const dateObj = new Date(day.date);
                let formattedDate;
                
                if (appLang === 'zh') {
                    const month = dateObj.getMonth() + 1;
                    const dayNum = dateObj.getDate();
                    formattedDate = `${month}æœˆ${dayNum}æ—¥`;
                } else {
                    formattedDate = dateObj.toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric'
                    });
                }
                
                const dayElement = document.createElement('div');
                dayElement.className = 'flex justify-between items-center p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800';
                dayElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center mr-3">
                            <i class="fas fa-calendar-check text-green-500"></i>
                        </div>
                        <div>
                            <div class="font-medium">${formattedDate}</div>
                            <div class="text-xs text-gray-500">
                                ${day.completed} ${appLang === 'zh' ? 'å·²å®Œæˆ' : 'completed'} / ${day.total} ${appLang === 'zh' ? 'æ€»ä»»åŠ¡' : 'total'}
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-green-500">${Math.round(day.completionRate * 100)}%</div>
                    </div>
                `;
                
                productiveDaysList.appendChild(dayElement);
            });
            
            // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
            if (topDays.length === 0) {
                productiveDaysList.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        ${appLang === 'zh' ? 'æš‚æ— ä»»åŠ¡æ•°æ®' : 'No task data available'}
                    </div>
                `;
            }
        }
        
        /**
         * æ¸²æŸ“æˆå°±åˆ—è¡¨
         */
        function renderAchievements() {
            const achievementsContainer = document.getElementById('achievements-container');
            achievementsContainer.innerHTML = '';
            
            // è·å–å·²è§£é”æˆå°±
            const unlockedAchievements = settings.gameStats.achievements || [];
            
            // æŸ¥æ‰¾ç›¸å…³æˆå°±æ•°æ®
            const achievementsToShow = achievements.filter(a => 
                unlockedAchievements.includes(a.id)
            );
            
            // å¦‚æœæ²¡æœ‰è§£é”ä»»ä½•æˆå°±ï¼Œæ˜¾ç¤ºé”å®šçŠ¶æ€
            if (achievementsToShow.length === 0) {
                for (let i = 0; i < 4; i++) {
                    const lockedAchievement = document.createElement('div');
                    lockedAchievement.className = 'achievement p-3 bg-gray-100 dark:bg-gray-800 opacity-50';
                    lockedAchievement.innerHTML = `
                        <div class="flex items-center">
                            <div class="text-2xl mr-3">ğŸ”’</div>
                            <div>
                                <div class="font-medium">${appLang === 'zh' ? 'æœªè§£é”' : 'Locked'}</div>
                                <div class="text-xs text-gray-500">${appLang === 'zh' ? 'ç»§ç»­åŠªåŠ›' : 'Keep going'}</div>
                            </div>
                        </div>
                    `;
                    achievementsContainer.appendChild(lockedAchievement);
                }
                return;
            }
            
            // æ¸²æŸ“æ¯ä¸ªå·²è§£é”çš„æˆå°±
            achievementsToShow.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = 'achievement p-3 bg-aurora-50 dark:bg-aurora-900/30';
                achievementElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="text-2xl mr-3">${achievement.icon}</div>
                        <div>
                            <div class="font-medium">${achievement.name[appLang]}</div>
                            <div class="text-xs text-gray-500">${achievement.description[appLang]}</div>
                        </div>
                    </div>
                `;
                achievementsContainer.appendChild(achievementElement);
            });
            
            // å¦‚æœæˆå°±æ•°é‡å°‘äº4ä¸ªï¼Œæ·»åŠ é”å®šçŠ¶æ€çš„æˆå°±å ä½
            const remainingSlots = 4 - achievementsToShow.length;
            for (let i = 0; i < remainingSlots; i++) {
                const lockedAchievement = document.createElement('div');
                lockedAchievement.className = 'achievement p-3 bg-gray-100 dark:bg-gray-800 opacity-50';
                lockedAchievement.innerHTML = `
                    <div class="flex items-center">
                        <div class="text-2xl mr-3">ğŸ”’</div>
                        <div>
                            <div class="font-medium">${appLang === 'zh' ? 'æœªè§£é”' : 'Locked'}</div>
                            <div class="text-xs text-gray-500">${appLang === 'zh' ? 'ç»§ç»­åŠªåŠ›' : 'Keep going'}</div>
                        </div>
                    </div>
                `;
                achievementsContainer.appendChild(lockedAchievement);
            }
        }
        
        // ==================== æœç´¢åŠŸèƒ½ ====================
        /**
         * æ‰§è¡Œä»»åŠ¡æœç´¢
         */
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
            const searchFilter = document.getElementById('search-filter').value;
            
            searchResultsContainer.innerHTML = '';
            
            // æ ¹æ®æ¡ä»¶è¿‡æ»¤ä»»åŠ¡
            let searchResults = tasks;
            
            // æ ¹æ®å®ŒæˆçŠ¶æ€è¿‡æ»¤
            if (searchFilter === 'completed') {
                searchResults = searchResults.filter(task => task.completed);
            } else if (searchFilter === 'active') {
                searchResults = searchResults.filter(task => !task.completed);
            }
            
            // æ ¹æ®æœç´¢è¯è¿‡æ»¤
            if (searchTerm) {
                searchResults = searchResults.filter(task => 
                    task.title.toLowerCase().includes(searchTerm) ||
                    (task.problem && task.problem.toLowerCase().includes(searchTerm)) ||
                    (task.solution && task.solution.toLowerCase().includes(searchTerm))
                );
            }
            
            // æŒ‰åˆ›å»ºæ—¥æœŸé™åºæ’åº
            searchResults.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            // å¦‚æœæ²¡æœ‰æœç´¢ç»“æœï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
            if (searchResults.length === 0) {
                searchResultsContainer.innerHTML = `
                    <div class="glass rounded-2xl p-6 text-center">
                        <p class="text-gray-500 dark:text-gray-400">
                            ${appLang === 'zh' ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä»»åŠ¡' : 'No matching tasks found'}
                        </p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰å¹´æœˆåˆ†ç»„æœç´¢ç»“æœ
            const resultsByYearMonth = {};
            
            searchResults.forEach(task => {
                const yearMonth = `${task.year}-${task.month}`;
                if (!resultsByYearMonth[yearMonth]) {
                    resultsByYearMonth[yearMonth] = [];
                }
                resultsByYearMonth[yearMonth].push(task);
            });
            
            // æŒ‰å¹´æœˆé™åºæ’åº
            const sortedYearMonths = Object.keys(resultsByYearMonth).sort((a, b) => {
                const [yearA, monthA] = a.split('-').map(Number);
                const [yearB, monthB] = b.split('-').map(Number);
                
                if (yearA !== yearB) return yearB - yearA;
                return monthB - monthA;
            });
            
            // æ¸²æŸ“æœç´¢ç»“æœ
            sortedYearMonths.forEach(yearMonth => {
                const [year, month] = yearMonth.split('-').map(Number);
                
                // åˆ›å»ºæœˆä»½æ ‡é¢˜
                const monthHeader = document.createElement('div');
                monthHeader.className = 'mb-3 mt-6 first:mt-0';
                
                if (appLang === 'zh') {
                    monthHeader.innerHTML = `<h3 class="text-lg font-semibold">${year}å¹´${monthNames.zh[month]}</h3>`;
                } else {
                    monthHeader.innerHTML = `<h3 class="text-lg font-semibold">${monthNames.en[month]} ${year}</h3>`;
                }
                
                searchResultsContainer.appendChild(monthHeader);
                
                // æŒ‰æ—¥æœŸç»§ç»­åˆ†ç»„
                const tasksByDate = {};
                resultsByYearMonth[yearMonth].forEach(task => {
                    if (!tasksByDate[task.date]) {
                        tasksByDate[task.date] = [];
                    }
                    tasksByDate[task.date].push(task);
                });
                
                // æŒ‰æ—¥æœŸé™åºæ’åº
                const sortedDates = Object.keys(tasksByDate).sort((a, b) => new Date(b) - new Date(a));
                
                // æ¸²æŸ“æ¯ä¸ªæ—¥æœŸçš„ä»»åŠ¡
                sortedDates.forEach(date => {
                    const dateObj = new Date(date);
                    let formattedDate;
                    
                    if (appLang === 'zh') {
                        const day = dateObj.getDate();
                        formattedDate = `${day}æ—¥`;
                    } else {
                        formattedDate = dateObj.toLocaleDateString('en-US', { day: 'numeric' });
                    }
                    
                    // åˆ›å»ºæ—¥æœŸæ ‡ç­¾
                    const dateLabel = document.createElement('div');
                    dateLabel.className = 'mb-2 text-sm text-gray-500 dark:text-gray-400 ml-2';
                    dateLabel.innerHTML = formattedDate;
                    searchResultsContainer.appendChild(dateLabel);
                    
                    // å¯¹å½“å‰æ—¥æœŸçš„ä»»åŠ¡æŒ‰å®ŒæˆçŠ¶æ€æ’åº
                    tasksByDate[date].sort((a, b) => {
                        if (a.completed === b.completed) {
                            return new Date(b.createdAt) - new Date(a.createdAt);
                        }
                        return a.completed ? 1 : -1; // æœªå®Œæˆçš„åœ¨å‰é¢
                    });
                    
                    // æ¸²æŸ“è¯¥æ—¥æœŸçš„æ‰€æœ‰ä»»åŠ¡
                    tasksByDate[date].forEach((task, index) => {
                        const taskElement = createTaskElement(task, index);
                        searchResultsContainer.appendChild(taskElement);
                    });
                });
            });
        }
        
        // ==================== å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ ====================
        /**
         * å¯¼å‡ºæ•°æ®ä¸ºJSONæ–‡ä»¶
         */
        function exportDataJson() {
            const dataToExport = {
                tasks: tasks,
                settings: {
                    ...settings,
                    gameMode,
                    language: appLang,
                    currentChallenge
                },
                exportDate: new Date().toISOString(),
                appVersion: '1.0.0'
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `auroraTasks_backup_${new Date().toISOString().split('T')[0]}.json`;
            
            // ç‚¹å‡»é“¾æ¥ä¸‹è½½æ–‡ä»¶
            document.body.appendChild(a);
            a.click();
            
            // æ¸…ç†
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
        
        /**
         * å¯¼å‡ºæ•°æ®ä¸ºMarkdownæ–‡ä»¶
         */
        function exportDataMarkdown() {
            // æŒ‰å¹´æœˆæ—¥åˆ†ç»„ä»»åŠ¡
            const tasksByYearMonthDay = {};
            
            tasks.forEach(task => {
                const date = task.date;
                if (!tasksByYearMonthDay[date]) {
                    tasksByYearMonthDay[date] = [];
                }
                tasksByYearMonthDay[date].push(task);
            });
            
            // æŒ‰æ—¥æœŸé™åºæ’åº
            const sortedDates = Object.keys(tasksByYearMonthDay).sort((a, b) => new Date(b) - new Date(a));
            
            let markdownContent = `# æå…‰ä»»åŠ¡ (AuroraTasks) ä»»åŠ¡å¯¼å‡º\n\n`;
            markdownContent += `å¯¼å‡ºæ—¥æœŸ: ${new Date().toLocaleDateString()}\n\n`;
            
            // éå†æ¯ä¸ªæ—¥æœŸ
            sortedDates.forEach(date => {
                const dateObj = new Date(date);
                let formattedDate;
                
                if (appLang === 'zh') {
                    const year = dateObj.getFullYear();
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    const weekday = weekdayNames.zh[dateObj.getDay()];
                    formattedDate = `${year}å¹´${month}æœˆ${day}æ—¥ ${weekday}`;
                } else {
                    formattedDate = dateObj.toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric',
                        month: 'long', 
                        day: 'numeric'
                    });
                }
                
                markdownContent += `## ${formattedDate}\n\n`;
                
                // æ·»åŠ è¯¥æ—¥æœŸçš„æ‰€æœ‰ä»»åŠ¡
                tasksByYearMonthDay[date].forEach(task => {
                    const status = task.completed ? '[x]' : '[ ]';
                    markdownContent += `- ${status} **${task.title}**\n`;
                    
                    if (task.problem) {
                        markdownContent += `  - é—®é¢˜/éš¾ç‚¹: ${task.problem}\n`;
                    }
                    
                    if (task.solution) {
                        markdownContent += `  - è§£å†³æ–¹æ¡ˆ: ${task.solution}\n`;
                    }
                    
                    markdownContent += '\n';
                });
            });
            
            // åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶
            const blob = new Blob([markdownContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `auroraTasks_export_${new Date().toISOString().split('T')[0]}.md`;
            
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
        
        /**
         * å¯¼å…¥æ•°æ®
         * @param {Event} e - æ–‡ä»¶è¾“å…¥äº‹ä»¶
         */
        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    // ç¡®è®¤æ•°æ®æœ‰æ•ˆ
                    if (!importedData.tasks || !Array.isArray(importedData.tasks)) {
                        throw new Error('æ— æ•ˆçš„æ•°æ®æ ¼å¼');
                    }
                    
                    // å¯¼å…¥å‰ç¡®è®¤
                    if (confirm(appLang === 'zh' ? 
                        'ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™å°†æ›¿æ¢å½“å‰çš„æ‰€æœ‰ä»»åŠ¡å’Œè®¾ç½®ã€‚' : 
                        'Are you sure you want to import this data? It will replace all current tasks and settings.')) {
                        
                        // å¯¼å…¥ä»»åŠ¡
                        tasks = importedData.tasks;
                        saveTasks();
                        
                        // å¯¼å…¥è®¾ç½®ï¼ˆå¦‚æœæœ‰ï¼‰
                        if (importedData.settings) {
                            settings = { ...settings, ...importedData.settings };
                            gameMode = importedData.settings.gameMode || false;
                            if (importedData.settings.language) {
                                appLang = importedData.settings.language;
                                changeLanguage(appLang);
                            }
                            if (importedData.settings.currentChallenge) {
                                currentChallenge = importedData.settings.currentChallenge;
                            }
                            saveSettings();
                        }
                        
                        // æ›´æ–°é¡µé¢
                        showToday();
                        
                        // æ›´æ–°è®¾ç½®é¢æ¿
                        applySettingsToUI();
                        
                        // æ˜¾ç¤ºæ¸¸æˆæ¨¡å¼ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                        if (gameMode) {
                            enableGameMode();
                        }
                        
                        alert(appLang === 'zh' ? 'æ•°æ®å¯¼å…¥æˆåŠŸï¼' : 'Data imported successfully!');
                    }
                } catch (error) {
                    alert(appLang === 'zh' ? 
                        `å¯¼å…¥å¤±è´¥: ${error.message}` : 
                        `Import failed: ${error.message}`);
                }
                
                // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œå…è®¸å†æ¬¡é€‰æ‹©åŒä¸€ä¸ªæ–‡ä»¶
                e.target.value = '';
            };
            
            reader.readAsText(file);
        }
        
        /**
         * é‡ç½®æ¸¸æˆè¿›åº¦
         */
        function resetGameProgress() {
            if (confirm(appLang === 'zh' ? 
                'ç¡®å®šè¦é‡ç½®æ¸¸æˆè¿›åº¦å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰ç­‰çº§ã€ç§¯åˆ†ã€æˆå°±å’ŒæŒ‘æˆ˜è®°å½•ã€‚' : 
                'Are you sure you want to reset game progress? This will clear all levels, points, achievements and challenge records.')) {
                
                // é‡ç½®æ¸¸æˆæ•°æ®
                settings.gameStats = {
                    level: 1,
                    points: 0,
                    nextLevelPoints: 100,
                    streak: 0,
                    longestStreak: 0,
                    lastActivity: null,
                    achievements: [],
                    challengesCompleted: 0,
                    aiSuggestionsUsed: 0
                };
                
                // é‡ç½®å½“å‰æŒ‘æˆ˜
                generateDailyChallenge();
                
                // ä¿å­˜è®¾ç½®
                saveSettings();
                
                // æ›´æ–°UI
                if (gameMode) {
                    updateGameStatsDisplay();
                }
                
                alert(appLang === 'zh' ? 'æ¸¸æˆè¿›åº¦å·²é‡ç½®ï¼' : 'Game progress has been reset!');
            }
        }
        
        /**
         * æ¸…é™¤æ‰€æœ‰æ•°æ®
         */
        function clearAllData() {
            if (confirm(appLang === 'zh' ? 
                'ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ä»»åŠ¡å’Œè®¾ç½®ï¼Œä¸”æ— æ³•æ¢å¤ã€‚' : 
                'Are you sure you want to clear all data? This will delete all tasks and settings, and cannot be undone.')) {
                
                // æ¸…é™¤localStorage
                localStorage.removeItem('auroraTasks_tasks');
                localStorage.removeItem('auroraTasks_settings');
                
                // é‡ç½®å†…å­˜ä¸­çš„æ•°æ®
                tasks = [];
                settings = {
                    confettiEnabled: true,
                    challengeEnabled: true,
                    achievementsEnabled: true,
                    gameStats: {
                        level: 1,
                        points: 0,
                        nextLevelPoints: 100,
                        streak: 0,
                        longestStreak: 0,
                        lastActivity: null,
                        achievements: [],
                        challengesCompleted: 0,
                        aiSuggestionsUsed: 0
                    },
                    ai: {
                        enabled: false,
                        provider: 'openai',
                        apiKey: '',
                        model: 'gpt-3.5-turbo',
                        customModel: '',
                        endpoint: ''
                    }
                };
                gameMode = false;
                
                // åˆ·æ–°é¡µé¢ä»¥é‡æ–°åŠ è½½åº”ç”¨
                location.reload();
            }
        }
        
        // ==================== æ¸¸æˆæ¨¡å¼åŠŸèƒ½ ====================
        /**
         * åˆ‡æ¢æ¸¸æˆæ¨¡å¼
         */
        function toggleGameMode() {
            if (gameMode) {
                disableGameMode();
            } else {
                enableGameMode();
            }
        }
        
        /**
         * å¯ç”¨æ¸¸æˆæ¨¡å¼
         */
        function enableGameMode() {
            gameMode = true;
            gameStatsSection.classList.remove('hidden');
            document.getElementById('game-mode-text').textContent = appLang === 'zh' ? 'æ¸¸æˆä¸­' : 'Game On';
            document.getElementById('game-mode-toggle').classList.add('bg-aurora-500', 'text-white');
            document.getElementById('game-mode-toggle').classList.remove('glass');
            
            // æ›´æ–°æ¸¸æˆç»Ÿè®¡æ˜¾ç¤º
            updateGameStatsDisplay();
            
            // å¦‚æœå¯ç”¨äº†æŒ‘æˆ˜ï¼Œæ›´æ–°æŒ‘æˆ˜æ˜¾ç¤º
            if (settings.challengeEnabled) {
                updateDailyChallenge();
            }
            
            // ä¿å­˜è®¾ç½®
            saveSettings();
        }
        
        /**
         * ç¦ç”¨æ¸¸æˆæ¨¡å¼
         */
        function disableGameMode() {
            gameMode = false;
            gameStatsSection.classList.add('hidden');
            document.getElementById('game-mode-text').textContent = appLang === 'zh' ? 'æ¸¸æˆæ¨¡å¼' : 'Game Mode';
            document.getElementById('game-mode-toggle').classList.remove('bg-aurora-500', 'text-white');
            document.getElementById('game-mode-toggle').classList.add('glass');
            
            // ä¿å­˜è®¾ç½®
            saveSettings();
        }
        
        /**
         * æ·»åŠ æ¸¸æˆç§¯åˆ†
         * @param {number} points - è¦æ·»åŠ çš„ç§¯åˆ†æ•°é‡ï¼ˆå¯ä»¥æ˜¯è´Ÿæ•°ï¼‰
         * @param {boolean} showEffect - æ˜¯å¦æ˜¾ç¤ºç§¯åˆ†æ•ˆæœ
         */
        function addGamePoints(points, showEffect = true) {
            // æ›´æ–°ç§¯åˆ†
            settings.gameStats.points += points;
            
            // ç¡®ä¿ç§¯åˆ†ä¸ä½äº0
            if (settings.gameStats.points < 0) {
                settings.gameStats.points = 0;
            }
            
            // æ£€æŸ¥æ˜¯å¦å‡çº§
            checkLevelUp();
            
            // æ›´æ–°æ¸¸æˆç»Ÿè®¡æ˜¾ç¤º
            updateGameStatsDisplay();
            
            // æ˜¾ç¤ºç§¯åˆ†è·å–æ•ˆæœ
            if (showEffect && points > 0) {
                showPointsEffect(points);
            }
            
            // ä¿å­˜è®¾ç½®
            saveSettings();
        }
        
        /**
         * æ£€æŸ¥æ˜¯å¦è¾¾åˆ°å‡çº§æ¡ä»¶
         */
        function checkLevelUp() {
            if (settings.gameStats.points >= settings.gameStats.nextLevelPoints) {
                // å‡çº§
                settings.gameStats.level++;
                
                // è®¡ç®—æ–°çš„å‡çº§è¦æ±‚ï¼ˆéšç­‰çº§å¢åŠ è€Œå¢åŠ ï¼‰
                const pointsForNextLevel = Math.floor(settings.gameStats.nextLevelPoints * 1.5);
                settings.gameStats.nextLevelPoints = pointsForNextLevel;
                
                // æ˜¾ç¤ºå‡çº§ç‰¹æ•ˆ
                showLevelUpEffect();
                
                // æ£€æŸ¥æ˜¯å¦è§£é”äº†ç­‰çº§ç›¸å…³çš„æˆå°±
                if (settings.achievementsEnabled) {
                    checkAchievements();
                }
            }
        }
        
        /**
         * ç”Ÿæˆæ¯æ—¥æŒ‘æˆ˜
         */
        function generateDailyChallenge() {
            // éšæœºé€‰æ‹©æŒ‘æˆ˜ç±»å‹
            const randomChallenge = challengeTypes[Math.floor(Math.random() * challengeTypes.length)];
            
            // ç”ŸæˆæŒ‘æˆ˜ç›®æ ‡
            const target = randomChallenge.target();
            
            // è®¡ç®—å¥–åŠ±
            const reward = randomChallenge.reward(target);
            
            // åˆ›å»ºæŒ‘æˆ˜å¯¹è±¡
            currentChallenge = {
                type: randomChallenge.id,
                target: target,
                progress: 0,
                reward: reward,
                date: new Date().toISOString().split('T')[0],
                completed: false,
                icon: randomChallenge.icon,
                text: randomChallenge.getText(target)
            };
            
            // ä¿å­˜è®¾ç½®
            saveSettings();
        }
        
        /**
         * æ›´æ–°æ¯æ—¥æŒ‘æˆ˜
         */
        function updateDailyChallenge() {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦ç”Ÿæˆæ–°æŒ‘æˆ˜
            const today = new Date().toISOString().split('T')[0];
            if (!currentChallenge || currentChallenge.date !== today) {
                generateDailyChallenge();
            }
            
            // æ›´æ–°æŒ‘æˆ˜æ˜¾ç¤º
            document.getElementById('challenge-icon').textContent = currentChallenge.icon;
            document.getElementById('challenge-text').textContent = currentChallenge.text;
            
            // æ›´æ–°è¿›åº¦
            const progressPercent = (currentChallenge.progress / currentChallenge.target) * 100;
            challengeProgress.style.width = `${Math.min(progressPercent, 100)}%`;
            challengeProgressText.textContent = `${currentChallenge.progress}/${currentChallenge.target}`;
            
            // å¦‚æœæŒ‘æˆ˜å·²å®Œæˆï¼Œæ·»åŠ å®Œæˆæ ·å¼
            if (currentChallenge.completed) {
                challengeProgress.classList.remove('bg-yellow-500');
                challengeProgress.classList.add('bg-green-500');
                document.getElementById('challenge-text').classList.add('line-through');
            } else {
                challengeProgress.classList.remove('bg-green-500');
                challengeProgress.classList.add('bg-yellow-500');
                document.getElementById('challenge-text').classList.remove('line-through');
            }
        }
        
        /**
         * æ›´æ–°æŒ‘æˆ˜è¿›åº¦
         * @param {number} amount - è¿›åº¦å¢åŠ é‡ï¼ˆå¯ä»¥æ˜¯è´Ÿæ•°ï¼‰
         */
        function updateChallengeProgress(amount) {
            if (!currentChallenge || currentChallenge.completed) return;
            
            // æ›´æ–°è¿›åº¦
            currentChallenge.progress += amount;
            
            // ç¡®ä¿è¿›åº¦ä¸ä½äº0
            if (currentChallenge.progress < 0) {
                currentChallenge.progress = 0;
            }
            
            // æ£€æŸ¥æ˜¯å¦å®ŒæˆæŒ‘æˆ˜
            if (currentChallenge.progress >= currentChallenge.target && !currentChallenge.completed) {
                currentChallenge.completed = true;
                
                // ç»™äºˆå¥–åŠ±
                addGamePoints(currentChallenge.reward, true);
                
                // æ›´æ–°å®Œæˆçš„æŒ‘æˆ˜è®¡æ•°
                settings.gameStats.challengesCompleted++;
                
                // æ£€æŸ¥æ˜¯å¦è§£é”äº†æŒ‘æˆ˜ç›¸å…³çš„æˆå°±
                if (settings.achievementsEnabled) {
                    checkAchievements();
                }
                
                // æ˜¾ç¤ºå®Œæˆé€šçŸ¥
                showChallengeCompletedNotification();
            }
            
            // æ›´æ–°æŒ‘æˆ˜æ˜¾ç¤º
            updateDailyChallenge();
            
            // ä¿å­˜è®¾ç½®
            saveSettings();
        }
        
        /**
         * æ˜¾ç¤ºæŒ‘æˆ˜å®Œæˆé€šçŸ¥
         */
        function showChallengeCompletedNotification() {
            // åˆ›å»ºæŒ‘æˆ˜å®Œæˆæç¤º
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-5 left-5 glass rounded-xl p-4 max-w-xs transform transition-all duration-500 translate-y-20 opacity-0 z-50';
            notification.innerHTML = `
                <div class="flex items-center">
                    <div class="text-2xl mr-3">ğŸ†</div>
                    <div>
                        <div class="font-semibold">${appLang === 'zh' ? 'æŒ‘æˆ˜å®Œæˆï¼' : 'Challenge Completed!'}</div>
                        <div class="text-sm">${appLang === 'zh' ? `è·å¾— ${currentChallenge.reward} ç§¯åˆ†å¥–åŠ±ï¼` : `You earned ${currentChallenge.reward} bonus points!`}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // æ˜¾ç¤ºé€šçŸ¥
            setTimeout(() => {
                notification.classList.remove('translate-y-20', 'opacity-0');
            }, 100);
            
            // 3ç§’åéšè—é€šçŸ¥
            setTimeout(() => {
                notification.classList.add('translate-y-20', 'opacity-0');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }
        
        /**
         * æ›´æ–°æ¸¸æˆç»Ÿè®¡æ˜¾ç¤º
         */
        function updateGameStatsDisplay() {
            playerLevelEl.textContent = settings.gameStats.level;
            playerPointsEl.textContent = settings.gameStats.points;
            playerStreakEl.textContent = settings.gameStats.streak || 0;
            
            // æ›´æ–°è¿›åº¦æ¡
            const progressPercentage = (settings.gameStats.points / settings.gameStats.nextLevelPoints) * 100;
            levelProgressBar.style.width = `${Math.min(progressPercentage, 100)}%`;
            
            // æ›´æ–°è¿›åº¦æ–‡æœ¬
            levelProgressText.textContent = `${settings.gameStats.points}/${settings.gameStats.nextLevelPoints}`;
        }
        
        /**
         * æ›´æ–°è¿ç»­å®Œæˆè®°å½•
         */
        function updateStreak() {
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            // è·å–ä»Šæ—¥å’Œæ˜¨æ—¥çš„ä»»åŠ¡
            const todayTasks = tasks.filter(task => task.date === today);
            const yesterdayTasks = tasks.filter(task => task.date === yesterdayStr);
            
            // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦æœ‰å®Œæˆçš„ä»»åŠ¡
            const todayCompleted = todayTasks.some(task => task.completed);
            
            // æ£€æŸ¥æ˜¨æ—¥æ˜¯å¦æœ‰å®Œæˆçš„ä»»åŠ¡
            const yesterdayCompleted = yesterdayTasks.some(task => task.completed);
            
            // è·å–ä¸Šæ¬¡æ´»åŠ¨æ—¥æœŸ
            const lastActivity = settings.gameStats.lastActivity;
            
            if (todayCompleted) {
                // å¦‚æœä»Šå¤©æœ‰å®Œæˆçš„ä»»åŠ¡
                if (lastActivity === yesterdayStr && yesterdayCompleted) {
                    // å¦‚æœæ˜¨å¤©ä¹Ÿæœ‰å®Œæˆçš„ä»»åŠ¡ï¼Œå¢åŠ è¿ç»­è®°å½•
                    settings.gameStats.streak++;
                } else if (lastActivity !== today) {
                    // å¦‚æœä¸æ˜¯è¿ç»­çš„ï¼Œé‡ç½®ä¸º1
                    settings.gameStats.streak = 1;
                }
                
                // æ›´æ–°ä¸Šæ¬¡æ´»åŠ¨æ—¥æœŸ
                settings.gameStats.lastActivity = today;
                
                // æ›´æ–°æœ€é•¿è¿ç»­è®°å½•
                if (settings.gameStats.streak > settings.gameStats.longestStreak) {
                    settings.gameStats.longestStreak = settings.gameStats.streak;
                }
            } else if (lastActivity && lastActivity !== today && lastActivity !== yesterdayStr) {
                // å¦‚æœæ—¢ä¸æ˜¯ä»Šå¤©ä¹Ÿä¸æ˜¯æ˜¨å¤©ï¼Œè¿ç»­è®°å½•ä¸­æ–­
                settings.gameStats.streak = 0;
            }
            
            // ä¿å­˜è®¾ç½®
            saveSettings();
            
            // æ›´æ–°æ¸¸æˆç»Ÿè®¡æ˜¾ç¤º
            if (gameMode) {
                updateGameStatsDisplay();
            }
            
            // æ£€æŸ¥æ˜¯å¦è§£é”äº†è¿ç»­è®°å½•ç›¸å…³çš„æˆå°±
            if (settings.achievementsEnabled) {
                checkAchievements();
            }
        }
        
        /**
         * æ£€æŸ¥æˆå°±è§£é”
         */
        function checkAchievements() {
            if (!settings.gameStats.achievements) {
                settings.gameStats.achievements = [];
            }
            
            // æ£€æŸ¥æ¯ä¸ªæˆå°±
            achievements.forEach(achievement => {
                // å¦‚æœæˆå°±å·²è§£é”ï¼Œè·³è¿‡
                if (settings.gameStats.achievements.includes(achievement.id)) {
                    return;
                }
                
                // æ£€æŸ¥æˆå°±æ¡ä»¶
                if (achievement.condition(settings.gameStats, tasks)) {
                    // è§£é”æˆå°±
                    settings.gameStats.achievements.push(achievement.id);
                    
                    // ç»™äºˆå¥–åŠ±ç§¯åˆ†
                    if (gameMode) {
                        addGamePoints(achievement.points, false);
                    }
                    
                    // æ˜¾ç¤ºæˆå°±è§£é”é€šçŸ¥
                    showAchievementNotification(achievement);
                }
            });
            
            // ä¿å­˜è®¾ç½®
            saveSettings();
        }
        
        /**
         * æ˜¾ç¤ºæˆå°±è§£é”é€šçŸ¥
         * @param {Object} achievement - æˆå°±å¯¹è±¡
         */
        function showAchievementNotification(achievement) {
            // è®¾ç½®é€šçŸ¥å†…å®¹
            document.getElementById('achievement-name').textContent = achievement.name[appLang];
            
            // æ˜¾ç¤ºé€šçŸ¥
            achievementNotification.classList.remove('hidden', 'translate-y-20', 'opacity-0');
            
            // 3ç§’åéšè—é€šçŸ¥
            setTimeout(() => {
                achievementNotification.classList.add('translate-y-20', 'opacity-0');
                setTimeout(() => {
                    achievementNotification.classList.add('hidden');
                }, 500);
            }, 3000);
        }
        
        /**
         * æ˜¾ç¤ºç§¯åˆ†è·å–ç‰¹æ•ˆ
         * @param {number} points - è·å¾—çš„ç§¯åˆ†
         */
        function showPointsEffect(points) {
            const pointsEffect = document.createElement('div');
            pointsEffect.className = 'fixed z-50 text-aurora-500 font-bold text-xl pointer-events-none';
            pointsEffect.style.left = `${Math.random() * 40 + 30}%`;
            pointsEffect.style.top = `${Math.random() * 30 + 30}%`;
            pointsEffect.textContent = `+${points}`;
            
            // æ·»åŠ åŠ¨ç”»
            pointsEffect.animate(
                [
                    { opacity: 0, transform: 'translateY(0) scale(0.5)' },
                    { opacity: 1, transform: 'translateY(-20px) scale(1.2)' },
                    { opacity: 0, transform: 'translateY(-50px) scale(1)' }
                ],
                {
                    duration: 1500,
                    easing: 'ease-out'
                }
            );
            
            document.body.appendChild(pointsEffect);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                document.body.removeChild(pointsEffect);
            }, 1500);
        }
        
        /**
         * æ˜¾ç¤ºå‡çº§ç‰¹æ•ˆ
         */
        function showLevelUpEffect() {
            // åˆ›å»ºå‡çº§æç¤º
            const levelUpEffect = document.createElement('div');
            levelUpEffect.className = 'fixed inset-0 flex items-center justify-center z-50 pointer-events-none';
            levelUpEffect.innerHTML = `
                <div class="glass p-6 rounded-2xl text-center fade-in">
                    <div class="text-4xl mb-2">ğŸ‰</div>
                    <div class="text-2xl font-bold text-aurora-500">
                        ${appLang === 'zh' ? 'å‡çº§äº†ï¼' : 'Level Up!'}
                    </div>
                    <div class="mt-2">
                        ${appLang === 'zh' ? 'ç­‰çº§' : 'Level'} ${settings.gameStats.level}
                    </div>
                </div>
            `;
            
            document.body.appendChild(levelUpEffect);
            
            // åˆ›å»ºå¤§é‡ç¤¼èŠ±
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const randomX = Math.random() * window.innerWidth;
                    const randomY = Math.random() * window.innerHeight / 3;
                    createConfettiParticle(randomX, randomY);
                }, i * 100);
            }
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                document.body.removeChild(levelUpEffect);
            }, 3000);
        }
        
        // ==================== è§†è§‰ç‰¹æ•ˆ ====================
        /**
         * åœ¨å¤é€‰æ¡†ä½ç½®åˆ›å»ºç¤¼èŠ±æ•ˆæœ
         * @param {HTMLElement} checkbox - å¤é€‰æ¡†å…ƒç´ 
         */
        function createConfetti(checkbox) {
            if (!settings.confettiEnabled) return;
            
            // è·å–å¤é€‰æ¡†ä½ç½®
            const rect = checkbox.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            
            // åˆ›å»ºå¤šä¸ªç²’å­
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    createConfettiParticle(x, y);
                }, i * 50);
            }
        }
        
        /**
         * åˆ›å»ºå•ä¸ªç¤¼èŠ±ç²’å­
         * @param {number} x - èµ·å§‹Xåæ ‡
         * @param {number} y - èµ·å§‹Yåæ ‡
         */
        function createConfettiParticle(x, y) {
            const colors = [
                '#8b5cf6', '#6d28d9', '#a78bfa', '#7c3aed', 
                '#ec4899', '#f97316', '#eab308', '#84cc16', '#06b6d4'
            ];
            
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            // éšæœºå½¢çŠ¶ï¼ˆåœ†å½¢æˆ–æ–¹å½¢ï¼‰
            confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
            
            // éšæœºé¢œè‰²
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // éšæœºå¤§å°
            const size = Math.random() * 10 + 5;
            confetti.style.width = `${size}px`;
            confetti.style.height = `${size}px`;
            
            // è®¾ç½®èµ·å§‹ä½ç½®
            confetti.style.left = `${x}px`;
            confetti.style.top = `${y}px`;
            
            // éšæœºåŠ¨ç”»å»¶è¿Ÿ
            confetti.style.animationDelay = `${Math.random() * 0.2}s`;
            
            // æ·»åŠ åˆ°æ–‡æ¡£
            document.body.appendChild(confetti);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                document.body.removeChild(confetti);
            }, 1500);
        }
        
        // ==================== è¯­è¨€åŠŸèƒ½ ====================
        /**
         * åˆ‡æ¢åº”ç”¨è¯­è¨€
         * @param {string} lang - è¯­è¨€ä»£ç  ('zh' æˆ– 'en')
         * @param {boolean} saveChanges - æ˜¯å¦ä¿å­˜è¯­è¨€è®¾ç½®ï¼Œé»˜è®¤ä¸ºtrue
         */
        function changeLanguage(lang, saveChanges = true) {
            appLang = lang;
            
            // æ›´æ–°æ‰€æœ‰å¸¦æœ‰ data-zh å’Œ data-en å±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-zh][data-en]').forEach(el => {
                el.textContent = el.getAttribute(`data-${lang}`);
            });
            
            // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
            updateTodayDate();
            
            // æ›´æ–°ä»»åŠ¡æ•°é‡æ–‡æœ¬
            if (todayContainer.classList.contains('hidden') === false) {
                renderTodayTasks();
            }
            
            // å¦‚æœå½’æ¡£é¡µé¢å¯è§ï¼Œæ›´æ–°å½’æ¡£å†…å®¹
            if (archiveContainer.classList.contains('hidden') === false) {
                renderArchiveYears();
            }
            
            // å¦‚æœä¹ æƒ¯è¿½è¸ªé¡µé¢å¯è§ï¼Œæ›´æ–°æ—¥å†
            if (habitContainer.classList.contains('hidden') === false) {
                renderCalendar();
                updateHabitStatistics();
            }
            
            // å¦‚æœç»Ÿè®¡é¡µé¢å¯è§ï¼Œæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            if (statsContainer.classList.contains('hidden') === false) {
                renderStatistics();
            }
            
            // æ›´æ–°æœç´¢å ä½ç¬¦
            document.getElementById('search-input').placeholder = 
                appLang === 'zh' ? 'è¾“å…¥å…³é”®è¯æœç´¢' : 'Enter keywords to search';
            
            // å¦‚æœå¯ç”¨äº†æ¸¸æˆæ¨¡å¼ï¼Œæ›´æ–°æŒ‘æˆ˜æ–‡æœ¬
            if (gameMode && settings.challengeEnabled && currentChallenge) {
                currentChallenge.text = challengeTypes.find(c => c.id === currentChallenge.type)
                    .getText(currentChallenge.target);
                updateDailyChallenge();
            }
            
            // ä¿å­˜è¯­è¨€è®¾ç½®
            if (saveChanges) {
                settings.language = appLang;
                saveSettings();
            }
        }
        
        // åˆå§‹åŒ–ç³»ç»Ÿæ·±è‰²æ¨¡å¼æ£€æµ‹
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>


</body></html>
